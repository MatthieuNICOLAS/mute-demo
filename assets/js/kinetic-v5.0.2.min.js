/*! KineticJS v5.0.2 2014-03-26 http://www.kineticjs.com by Eric Rowell @ericdrowell - MIT License https://github.com/ericdrowell/KineticJS/wiki/License*/
var Kinetic=***REMOVED******REMOVED***;!function(a)***REMOVED***var b=Math.PI/180;Kinetic=***REMOVED***version:"5.0.2",stages:[],idCounter:0,ids:***REMOVED******REMOVED***,names:***REMOVED******REMOVED***,shapes:***REMOVED******REMOVED***,listenClickTap:!1,inDblClickWindow:!1,enableTrace:!1,traceArrMax:100,dblClickWindow:400,pixelRatio:void 0,dragDistance:0,angleDeg:!0,UA:function()***REMOVED***var b=a.navigator&&a.navigator.userAgent||"",c=b.toLowerCase(),d=/(chrome)[ \/]([\w.]+)/.exec(c)||/(webkit)[ \/]([\w.]+)/.exec(c)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(c)||/(msie) ([\w.]+)/.exec(c)||c.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(c)||[],e=!!b.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i);return***REMOVED***browser:d[1]||"",version:d[2]||"0",mobile:e***REMOVED******REMOVED***(),Filters:***REMOVED******REMOVED***,Node:function(a)***REMOVED***this._init(a)***REMOVED***,Shape:function(a)***REMOVED***this.__init(a)***REMOVED***,Container:function(a)***REMOVED***this.__init(a)***REMOVED***,Stage:function(a)***REMOVED***this.___init(a)***REMOVED***,BaseLayer:function(a)***REMOVED***this.___init(a)***REMOVED***,Layer:function(a)***REMOVED***this.____init(a)***REMOVED***,FastLayer:function(a)***REMOVED***this.____init(a)***REMOVED***,Group:function(a)***REMOVED***this.___init(a)***REMOVED***,isDragging:function()***REMOVED***var a=Kinetic.DD;return a?a.isDragging:!1***REMOVED***,isDragReady:function()***REMOVED***var a=Kinetic.DD;return a?!!a.node:!1***REMOVED***,_addId:function(a,b)***REMOVED***void 0!==b&&(this.ids[b]=a)***REMOVED***,_removeId:function(a)***REMOVED***void 0!==a&&delete this.ids[a]***REMOVED***,_addName:function(a,b)***REMOVED***void 0!==b&&(void 0===this.names[b]&&(this.names[b]=[]),this.names[b].push(a))***REMOVED***,_removeName:function(a,b)***REMOVED***if(void 0!==a)***REMOVED***var c=this.names[a];if(void 0!==c)***REMOVED***for(var d=0;d<c.length;d++)***REMOVED***var e=c[d];e._id===b&&c.splice(d,1)***REMOVED***0===c.length&&delete this.names[a]***REMOVED******REMOVED******REMOVED***,getAngle:function(a)***REMOVED***return this.angleDeg?a*b:a***REMOVED******REMOVED******REMOVED***(this),function(a,b)***REMOVED***if("object"==typeof exports)***REMOVED***var c=require("canvas"),d=require("jsdom").jsdom,e=d("<!DOCTYPE html><html><head></head><body></body></html>"),f=b();return Kinetic.document=e,Kinetic.window=Kinetic.document.createWindow(),Kinetic.window.Image=c.Image,Kinetic.root=a,Kinetic._nodeCanvas=c,void(module.exports=f)***REMOVED***"function"==typeof define&&define.amd&&define(b),Kinetic.document=document,Kinetic.window=window,Kinetic.root=a***REMOVED***((1,eval)("this"),function()***REMOVED***return Kinetic***REMOVED***),function()***REMOVED***Kinetic.Collection=function()***REMOVED***var a=[].slice.call(arguments),b=a.length,c=0;for(this.length=b;b>c;c++)this[c]=a[c];return this***REMOVED***,Kinetic.Collection.prototype=[],Kinetic.Collection.prototype.each=function(a)***REMOVED***for(var b=0;b<this.length;b++)a(this[b],b)***REMOVED***,Kinetic.Collection.prototype.toArray=function()***REMOVED***var a,b=[],c=this.length;for(a=0;c>a;a++)b.push(this[a]);return b***REMOVED***,Kinetic.Collection.toCollection=function(a)***REMOVED***var b,c=new Kinetic.Collection,d=a.length;for(b=0;d>b;b++)c.push(a[b]);return c***REMOVED***,Kinetic.Collection._mapMethod=function(a)***REMOVED***Kinetic.Collection.prototype[a]=function()***REMOVED***var b,c=this.length,d=[].slice.call(arguments);for(b=0;c>b;b++)this[b][a].apply(this[b],d);return this***REMOVED******REMOVED***,Kinetic.Collection.mapMethods=function(a)***REMOVED***var b=a.prototype;for(var c in b)Kinetic.Collection._mapMethod(c)***REMOVED***,Kinetic.Transform=function()***REMOVED***this.m=[1,0,0,1,0,0]***REMOVED***,Kinetic.Transform.prototype=***REMOVED***translate:function(a,b)***REMOVED***this.m[4]+=this.m[0]*a+this.m[2]*b,this.m[5]+=this.m[1]*a+this.m[3]*b***REMOVED***,scale:function(a,b)***REMOVED***this.m[0]*=a,this.m[1]*=a,this.m[2]*=b,this.m[3]*=b***REMOVED***,rotate:function(a)***REMOVED***var b=Math.cos(a),c=Math.sin(a),d=this.m[0]*b+this.m[2]*c,e=this.m[1]*b+this.m[3]*c,f=this.m[0]*-c+this.m[2]*b,g=this.m[1]*-c+this.m[3]*b;this.m[0]=d,this.m[1]=e,this.m[2]=f,this.m[3]=g***REMOVED***,getTranslation:function()***REMOVED***return***REMOVED***x:this.m[4],y:this.m[5]***REMOVED******REMOVED***,skew:function(a,b)***REMOVED***var c=this.m[0]+this.m[2]*b,d=this.m[1]+this.m[3]*b,e=this.m[2]+this.m[0]*a,f=this.m[3]+this.m[1]*a;this.m[0]=c,this.m[1]=d,this.m[2]=e,this.m[3]=f***REMOVED***,multiply:function(a)***REMOVED***var b=this.m[0]*a.m[0]+this.m[2]*a.m[1],c=this.m[1]*a.m[0]+this.m[3]*a.m[1],d=this.m[0]*a.m[2]+this.m[2]*a.m[3],e=this.m[1]*a.m[2]+this.m[3]*a.m[3],f=this.m[0]*a.m[4]+this.m[2]*a.m[5]+this.m[4],g=this.m[1]*a.m[4]+this.m[3]*a.m[5]+this.m[5];this.m[0]=b,this.m[1]=c,this.m[2]=d,this.m[3]=e,this.m[4]=f,this.m[5]=g***REMOVED***,invert:function()***REMOVED***var a=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),b=this.m[3]*a,c=-this.m[1]*a,d=-this.m[2]*a,e=this.m[0]*a,f=a*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),g=a*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=b,this.m[1]=c,this.m[2]=d,this.m[3]=e,this.m[4]=f,this.m[5]=g***REMOVED***,getMatrix:function()***REMOVED***return this.m***REMOVED***,setAbsolutePosition:function(a,b)***REMOVED***var c=this.m[0],d=this.m[1],e=this.m[2],f=this.m[3],g=this.m[4],h=this.m[5],i=(c*(b-h)-d*(a-g))/(c*f-d*e),j=(a-g-e*i)/c;this.translate(j,i)***REMOVED******REMOVED***;var a="2d",b="[object Array]",c="[object Number]",d="[object String]",e=Math.PI/180,f=180/Math.PI,g="#",h="",i="0",j="Kinetic warning: ",k="Kinetic error: ",l="rgb(",m=***REMOVED***aqua:[0,255,255],lime:[0,255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,255],navy:[0,0,128],white:[255,255,255],fuchsia:[255,0,255],olive:[128,128,0],yellow:[255,255,0],orange:[255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[255,0,0],pink:[255,192,203],cyan:[0,255,255],transparent:[255,255,255,0]***REMOVED***,n=/rgb\((\d***REMOVED***1,3***REMOVED***),(\d***REMOVED***1,3***REMOVED***),(\d***REMOVED***1,3***REMOVED***)\)/;Kinetic.Util=***REMOVED***_isElement:function(a)***REMOVED***return!(!a||1!=a.nodeType)***REMOVED***,_isFunction:function(a)***REMOVED***return!!(a&&a.constructor&&a.call&&a.apply)***REMOVED***,_isObject:function(a)***REMOVED***return!!a&&a.constructor==Object***REMOVED***,_isArray:function(a)***REMOVED***return Object.prototype.toString.call(a)==b***REMOVED***,_isNumber:function(a)***REMOVED***return Object.prototype.toString.call(a)==c***REMOVED***,_isString:function(a)***REMOVED***return Object.prototype.toString.call(a)==d***REMOVED***,_throttle:function(a,b,c)***REMOVED***var d,e,f,g=null,h=0;c||(c=***REMOVED******REMOVED***);var i=function()***REMOVED***h=c.leading===!1?0:(new Date).getTime(),g=null,f=a.apply(d,e),d=e=null***REMOVED***;return function()***REMOVED***var j=(new Date).getTime();h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,0>=k?(clearTimeout(g),g=null,h=j,f=a.apply(d,e),d=e=null):g||c.trailing===!1||(g=setTimeout(i,k)),f***REMOVED******REMOVED***,_hasMethods:function(a)***REMOVED***var b,c=[];for(b in a)this._isFunction(a[b])&&c.push(b);return c.length>0***REMOVED***,createCanvasElement:function()***REMOVED***var a=Kinetic.document.createElement("canvas");return a.style=a.style||***REMOVED******REMOVED***,a***REMOVED***,isBrowser:function()***REMOVED***return"object"!=typeof exports***REMOVED***,_isInDocument:function(a)***REMOVED***for(;a=a.parentNode;)if(a==Kinetic.document)return!0;return!1***REMOVED***,_simplifyArray:function(a)***REMOVED***var b,c,d=[],e=a.length,f=Kinetic.Util;for(b=0;e>b;b++)c=a[b],f._isNumber(c)?c=Math.round(1e3*c)/1e3:f._isString(c)||(c=c.toString()),d.push(c);return d***REMOVED***,_getImage:function(b,c)***REMOVED***var d,e;if(b)if(this._isElement(b))c(b);else if(this._isString(b))d=new Kinetic.window.Image,d.onload=function()***REMOVED***c(d)***REMOVED***,d.src=b;else if(b.data)***REMOVED***e=Kinetic.Util.createCanvasElement(),e.width=b.width,e.height=b.height;var f=e.getContext(a);f.putImageData(b,0,0),this._getImage(e.toDataURL(),c)***REMOVED***else c(null);else c(null)***REMOVED***,_getRGBAString:function(a)***REMOVED***var b=a.red||0,c=a.green||0,d=a.blue||0,e=a.alpha||1;return["rgba(",b,",",c,",",d,",",e,")"].join(h)***REMOVED***,_rgbToHex:function(a,b,c)***REMOVED***return((1<<24)+(a<<16)+(b<<8)+c).toString(16).slice(1)***REMOVED***,_hexToRgb:function(a)***REMOVED***a=a.replace(g,h);var b=parseInt(a,16);return***REMOVED***r:b>>16&255,g:b>>8&255,b:255&b***REMOVED******REMOVED***,getRandomColor:function()***REMOVED***for(var a=(16777215*Math.random()<<0).toString(16);a.length<6;)a=i+a;return g+a***REMOVED***,get:function(a,b)***REMOVED***return void 0===a?b:a***REMOVED***,getRGB:function(a)***REMOVED***var b;return a in m?(b=m[a],***REMOVED***r:b[0],g:b[1],b:b[2]***REMOVED***):a[0]===g?this._hexToRgb(a.substring(1)):a.substr(0,4)===l?(b=n.exec(a.replace(/ /g,"")),***REMOVED***r:parseInt(b[1],10),g:parseInt(b[2],10),b:parseInt(b[3],10)***REMOVED***):***REMOVED***r:0,g:0,b:0***REMOVED******REMOVED***,_merge:function(a,b)***REMOVED***var c=this._clone(b);for(var d in a)c[d]=this._isObject(a[d])?this._merge(a[d],c[d]):a[d];return c***REMOVED***,cloneObject:function(a)***REMOVED***var b=***REMOVED******REMOVED***;for(var c in a)b[c]=this._isObject(a[c])?this.cloneObject(a[c]):this._isArray(a[c])?this.cloneArray(a[c]):a[c];return b***REMOVED***,cloneArray:function(a)***REMOVED***return a.slice(0)***REMOVED***,_degToRad:function(a)***REMOVED***return a*e***REMOVED***,_radToDeg:function(a)***REMOVED***return a*f***REMOVED***,_capitalize:function(a)***REMOVED***return a.charAt(0).toUpperCase()+a.slice(1)***REMOVED***,error:function(a)***REMOVED***throw new Error(k+a)***REMOVED***,warn:function(a)***REMOVED***Kinetic.root.console&&console.warn&&console.warn(j+a)***REMOVED***,extend:function(a,b)***REMOVED***for(var c in b.prototype)c in a.prototype||(a.prototype[c]=b.prototype[c])***REMOVED***,addMethods:function(a,b)***REMOVED***var c;for(c in b)a.prototype[c]=b[c]***REMOVED***,_getControlPoints:function(a,b,c,d,e,f,g)***REMOVED***var h=Math.sqrt(Math.pow(c-a,2)+Math.pow(d-b,2)),i=Math.sqrt(Math.pow(e-c,2)+Math.pow(f-d,2)),j=g*h/(h+i),k=g*i/(h+i),l=c-j*(e-a),m=d-j*(f-b),n=c+k*(e-a),o=d+k*(f-b);return[l,m,n,o]***REMOVED***,_expandPoints:function(a,b)***REMOVED***var c,d,e=a.length,f=[];for(c=2;e-2>c;c+=2)d=Kinetic.Util._getControlPoints(a[c-2],a[c-1],a[c],a[c+1],a[c+2],a[c+3],b),f.push(d[0]),f.push(d[1]),f.push(a[c]),f.push(a[c+1]),f.push(d[2]),f.push(d[3]);return f***REMOVED***,_removeLastLetter:function(a)***REMOVED***return a.substring(0,a.length-1)***REMOVED******REMOVED******REMOVED***(),function()***REMOVED***var a=Kinetic.Util.createCanvasElement(),b=a.getContext("2d"),c=Kinetic.UA.mobile?function()***REMOVED***var a=window.devicePixelRatio||1,c=b.webkitBackingStorePixelRatio||b.mozBackingStorePixelRatio||b.msBackingStorePixelRatio||b.oBackingStorePixelRatio||b.backingStorePixelRatio||1;return a/c***REMOVED***():1;Kinetic.Canvas=function(a)***REMOVED***this.init(a)***REMOVED***,Kinetic.Canvas.prototype=***REMOVED***init:function(a)***REMOVED***a=a||***REMOVED******REMOVED***;var b=a.pixelRatio||Kinetic.pixelRatio||c;this.pixelRatio=b,this._canvas=Kinetic.Util.createCanvasElement(),this._canvas.style.padding=0,this._canvas.style.margin=0,this._canvas.style.border=0,this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top=0,this._canvas.style.left=0***REMOVED***,getContext:function()***REMOVED***return this.context***REMOVED***,getPixelRatio:function()***REMOVED***return this.pixelRatio***REMOVED***,setPixelRatio:function(a)***REMOVED***this.pixelRatio=a,this.setSize(this.getWidth(),this.getHeight())***REMOVED***,setWidth:function(a)***REMOVED***this.width=this._canvas.width=a*this.pixelRatio,this._canvas.style.width=a+"px"***REMOVED***,setHeight:function(a)***REMOVED***this.height=this._canvas.height=a*this.pixelRatio,this._canvas.style.height=a+"px"***REMOVED***,getWidth:function()***REMOVED***return this.width***REMOVED***,getHeight:function()***REMOVED***return this.height***REMOVED***,setSize:function(a,b)***REMOVED***this.setWidth(a),this.setHeight(b)***REMOVED***,toDataURL:function(a,b)***REMOVED***try***REMOVED***return this._canvas.toDataURL(a,b)***REMOVED***catch(c)***REMOVED***try***REMOVED***return this._canvas.toDataURL()***REMOVED***catch(d)***REMOVED***return Kinetic.Util.warn("Unable to get data URL. "+d.message),""***REMOVED******REMOVED******REMOVED******REMOVED***,Kinetic.SceneCanvas=function(a)***REMOVED***a=a||***REMOVED******REMOVED***;var b=a.width||0,c=a.height||0;Kinetic.Canvas.call(this,a),this.context=new Kinetic.SceneContext(this),this.setSize(b,c)***REMOVED***,Kinetic.SceneCanvas.prototype=***REMOVED***setWidth:function(a)***REMOVED***var b=this.pixelRatio,c=this.getContext()._context;Kinetic.Canvas.prototype.setWidth.call(this,a),c.scale(b,b)***REMOVED***,setHeight:function(a)***REMOVED***var b=this.pixelRatio,c=this.getContext()._context;Kinetic.Canvas.prototype.setHeight.call(this,a),c.scale(b,b)***REMOVED******REMOVED***,Kinetic.Util.extend(Kinetic.SceneCanvas,Kinetic.Canvas),Kinetic.HitCanvas=function(a)***REMOVED***a=a||***REMOVED******REMOVED***;var b=a.width||0,c=a.height||0;Kinetic.Canvas.call(this,a),this.context=new Kinetic.HitContext(this),this.setSize(b,c)***REMOVED***,Kinetic.Util.extend(Kinetic.HitCanvas,Kinetic.Canvas)***REMOVED***(),function()***REMOVED***var a=",",b="(",c=")",d="([",e="])",f=";",g="()",h="=",i=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"];Kinetic.Context=function(a)***REMOVED***this.init(a)***REMOVED***,Kinetic.Context.prototype=***REMOVED***init:function(a)***REMOVED***this.canvas=a,this._context=a._canvas.getContext("2d"),Kinetic.enableTrace&&(this.traceArr=[],this._enableTrace())***REMOVED***,fillShape:function(a)***REMOVED***a.getFillEnabled()&&this._fill(a)***REMOVED***,strokeShape:function(a)***REMOVED***a.getStrokeEnabled()&&this._stroke(a)***REMOVED***,fillStrokeShape:function(a)***REMOVED***var b=a.getFillEnabled();b&&this._fill(a),a.getStrokeEnabled()&&this._stroke(a)***REMOVED***,getTrace:function(i)***REMOVED***var j,k,l,m,n=this.traceArr,o=n.length,p="";for(j=0;o>j;j++)k=n[j],l=k.method,l?(m=k.args,p+=l,p+=i?g:Kinetic.Util._isArray(m[0])?d+m.join(a)+e:b+m.join(a)+c):(p+=k.property,i||(p+=h+k.val)),p+=f;return p***REMOVED***,clearTrace:function()***REMOVED***this.traceArr=[]***REMOVED***,_trace:function(a)***REMOVED***var b,c=this.traceArr;c.push(a),b=c.length,b>=Kinetic.traceArrMax&&c.shift()***REMOVED***,reset:function()***REMOVED***var a=this.getCanvas().getPixelRatio();this.setTransform(1*a,0,0,1*a,0,0)***REMOVED***,getCanvas:function()***REMOVED***return this.canvas***REMOVED***,clear:function(a)***REMOVED***var b=this.getCanvas();a?this.clearRect(a.x||0,a.y||0,a.width||0,a.height||0):this.clearRect(0,0,b.getWidth(),b.getHeight())***REMOVED***,_applyLineCap:function(a)***REMOVED***var b=a.getLineCap();b&&this.setAttr("lineCap",b)***REMOVED***,_applyOpacity:function(a)***REMOVED***var b=a.getAbsoluteOpacity();1!==b&&this.setAttr("globalAlpha",b)***REMOVED***,_applyLineJoin:function(a)***REMOVED***var b=a.getLineJoin();b&&this.setAttr("lineJoin",b)***REMOVED***,setAttr:function(a,b)***REMOVED***this._context[a]=b***REMOVED***,arc:function()***REMOVED***var a=arguments;this._context.arc(a[0],a[1],a[2],a[3],a[4],a[5])***REMOVED***,beginPath:function()***REMOVED***this._context.beginPath()***REMOVED***,bezierCurveTo:function()***REMOVED***var a=arguments;this._context.bezierCurveTo(a[0],a[1],a[2],a[3],a[4],a[5])***REMOVED***,clearRect:function()***REMOVED***var a=arguments;this._context.clearRect(a[0],a[1],a[2],a[3])***REMOVED***,clip:function()***REMOVED***this._context.clip()***REMOVED***,closePath:function()***REMOVED***this._context.closePath()***REMOVED***,createImageData:function()***REMOVED***var a=arguments;return 2===a.length?this._context.createImageData(a[0],a[1]):1===a.length?this._context.createImageData(a[0]):void 0***REMOVED***,createLinearGradient:function()***REMOVED***var a=arguments;return this._context.createLinearGradient(a[0],a[1],a[2],a[3])***REMOVED***,createPattern:function()***REMOVED***var a=arguments;return this._context.createPattern(a[0],a[1])***REMOVED***,createRadialGradient:function()***REMOVED***var a=arguments;return this._context.createRadialGradient(a[0],a[1],a[2],a[3],a[4],a[5])***REMOVED***,drawImage:function()***REMOVED***var a=arguments,b=this._context;3===a.length?b.drawImage(a[0],a[1],a[2]):5===a.length?b.drawImage(a[0],a[1],a[2],a[3],a[4]):9===a.length&&b.drawImage(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8])***REMOVED***,fill:function()***REMOVED***this._context.fill()***REMOVED***,fillText:function()***REMOVED***var a=arguments;this._context.fillText(a[0],a[1],a[2])***REMOVED***,getImageData:function()***REMOVED***var a=arguments;return this._context.getImageData(a[0],a[1],a[2],a[3])***REMOVED***,lineTo:function()***REMOVED***var a=arguments;this._context.lineTo(a[0],a[1])***REMOVED***,moveTo:function()***REMOVED***var a=arguments;this._context.moveTo(a[0],a[1])***REMOVED***,rect:function()***REMOVED***var a=arguments;this._context.rect(a[0],a[1],a[2],a[3])***REMOVED***,putImageData:function()***REMOVED***var a=arguments;this._context.putImageData(a[0],a[1],a[2])***REMOVED***,quadraticCurveTo:function()***REMOVED***var a=arguments;this._context.quadraticCurveTo(a[0],a[1],a[2],a[3])***REMOVED***,restore:function()***REMOVED***this._context.restore()***REMOVED***,rotate:function()***REMOVED***var a=arguments;this._context.rotate(a[0])***REMOVED***,save:function()***REMOVED***this._context.save()***REMOVED***,scale:function()***REMOVED***var a=arguments;this._context.scale(a[0],a[1])***REMOVED***,setLineDash:function()***REMOVED***var a=arguments,b=this._context;this._context.setLineDash?b.setLineDash(a[0]):"mozDash"in b?b.mozDash=a[0]:"webkitLineDash"in b&&(b.webkitLineDash=a[0])***REMOVED***,setTransform:function()***REMOVED***var a=arguments;this._context.setTransform(a[0],a[1],a[2],a[3],a[4],a[5])***REMOVED***,stroke:function()***REMOVED***this._context.stroke()***REMOVED***,strokeText:function()***REMOVED***var a=arguments;this._context.strokeText(a[0],a[1],a[2])***REMOVED***,transform:function()***REMOVED***var a=arguments;this._context.transform(a[0],a[1],a[2],a[3],a[4],a[5])***REMOVED***,translate:function()***REMOVED***var a=arguments;this._context.translate(a[0],a[1])***REMOVED***,_enableTrace:function()***REMOVED***var a,b,c=this,d=i.length,e=Kinetic.Util._simplifyArray,f=this.setAttr,g=function(a)***REMOVED***var d,f=c[a];c[a]=function()***REMOVED***return b=e(Array.prototype.slice.call(arguments,0)),d=f.apply(c,arguments),c._trace(***REMOVED***method:a,args:b***REMOVED***),d***REMOVED******REMOVED***;for(a=0;d>a;a++)g(i[a]);c.setAttr=function()***REMOVED***f.apply(c,arguments),c._trace(***REMOVED***property:arguments[0],val:arguments[1]***REMOVED***)***REMOVED******REMOVED******REMOVED***,Kinetic.SceneContext=function(a)***REMOVED***Kinetic.Context.call(this,a)***REMOVED***,Kinetic.SceneContext.prototype=***REMOVED***_fillColor:function(a)***REMOVED***var b=a.fill()||Kinetic.Util._getRGBAString(***REMOVED***red:a.fillRed(),green:a.fillGreen(),blue:a.fillBlue(),alpha:a.fillAlpha()***REMOVED***);this.setAttr("fillStyle",b),a._fillFunc(this)***REMOVED***,_fillPattern:function(a)***REMOVED***var b=a.getFillPatternImage(),c=a.getFillPatternX(),d=a.getFillPatternY(),e=a.getFillPatternScale(),f=Kinetic.getAngle(a.getFillPatternRotation()),g=a.getFillPatternOffset(),h=a.getFillPatternRepeat();(c||d)&&this.translate(c||0,d||0),f&&this.rotate(f),e&&this.scale(e.x,e.y),g&&this.translate(-1*g.x,-1*g.y),this.setAttr("fillStyle",this.createPattern(b,h||"repeat")),this.fill()***REMOVED***,_fillLinearGradient:function(a)***REMOVED***var b=a.getFillLinearGradientStartPoint(),c=a.getFillLinearGradientEndPoint(),d=a.getFillLinearGradientColorStops(),e=this.createLinearGradient(b.x,b.y,c.x,c.y);if(d)***REMOVED***for(var f=0;f<d.length;f+=2)e.addColorStop(d[f],d[f+1]);this.setAttr("fillStyle",e),this.fill()***REMOVED******REMOVED***,_fillRadialGradient:function(a)***REMOVED***for(var b=a.getFillRadialGradientStartPoint(),c=a.getFillRadialGradientEndPoint(),d=a.getFillRadialGradientStartRadius(),e=a.getFillRadialGradientEndRadius(),f=a.getFillRadialGradientColorStops(),g=this.createRadialGradient(b.x,b.y,d,c.x,c.y,e),h=0;h<f.length;h+=2)g.addColorStop(f[h],f[h+1]);this.setAttr("fillStyle",g),this.fill()***REMOVED***,_fill:function(a)***REMOVED***var b=a.fill()||a.fillRed()||a.fillGreen()||a.fillBlue(),c=a.getFillPatternImage(),d=a.getFillLinearGradientColorStops(),e=a.getFillRadialGradientColorStops(),f=a.getFillPriority();b&&"color"===f?this._fillColor(a):c&&"pattern"===f?this._fillPattern(a):d&&"linear-gradient"===f?this._fillLinearGradient(a):e&&"radial-gradient"===f?this._fillRadialGradient(a):b?this._fillColor(a):c?this._fillPattern(a):d?this._fillLinearGradient(a):e&&this._fillRadialGradient(a)***REMOVED***,_stroke:function(a)***REMOVED***var b=a.dash(),c=a.getStrokeScaleEnabled();a.hasStroke()&&(c||(this.save(),this.setTransform(1,0,0,1,0,0)),this._applyLineCap(a),b&&a.dashEnabled()&&this.setLineDash(b),this.setAttr("lineWidth",a.strokeWidth()),this.setAttr("strokeStyle",a.stroke()||Kinetic.Util._getRGBAString(***REMOVED***red:a.strokeRed(),green:a.strokeGreen(),blue:a.strokeBlue(),alpha:a.strokeAlpha()***REMOVED***)),a._strokeFunc(this),c||this.restore())***REMOVED***,_applyShadow:function(a)***REMOVED***var b=Kinetic.Util,c=a.getAbsoluteOpacity(),d=b.get(a.getShadowColor(),"black"),e=b.get(a.getShadowBlur(),5),f=b.get(a.getShadowOpacity(),1),g=b.get(a.getShadowOffset(),***REMOVED***x:0,y:0***REMOVED***);f&&this.setAttr("globalAlpha",f*c),this.setAttr("shadowColor",d),this.setAttr("shadowBlur",e),this.setAttr("shadowOffsetX",g.x),this.setAttr("shadowOffsetY",g.y)***REMOVED******REMOVED***,Kinetic.Util.extend(Kinetic.SceneContext,Kinetic.Context),Kinetic.HitContext=function(a)***REMOVED***Kinetic.Context.call(this,a)***REMOVED***,Kinetic.HitContext.prototype=***REMOVED***_fill:function(a)***REMOVED***this.save(),this.setAttr("fillStyle",a.colorKey),a._fillFuncHit(this),this.restore()***REMOVED***,_stroke:function(a)***REMOVED***a.hasStroke()&&(this._applyLineCap(a),this.setAttr("lineWidth",a.strokeWidth()),this.setAttr("strokeStyle",a.colorKey),a._strokeFuncHit(this))***REMOVED******REMOVED***,Kinetic.Util.extend(Kinetic.HitContext,Kinetic.Context)***REMOVED***(),function()***REMOVED***var a="get",b="set";Kinetic.Factory=***REMOVED***addGetterSetter:function(a,b,c,d,e)***REMOVED***this.addGetter(a,b,c),this.addSetter(a,b,d,e),this.addOverloadedGetterSetter(a,b)***REMOVED***,addGetter:function(b,c,d)***REMOVED***var e=a+Kinetic.Util._capitalize(c);b.prototype[e]=function()***REMOVED***var a=this.attrs[c];return void 0===a?d:a***REMOVED******REMOVED***,addSetter:function(a,c,d,e)***REMOVED***var f=b+Kinetic.Util._capitalize(c);a.prototype[f]=function(a)***REMOVED***return d&&(a=d.call(this,a)),this._setAttr(c,a),e&&e.call(this),this***REMOVED******REMOVED***,addComponentsGetterSetter:function(c,d,e,f,g)***REMOVED***var h,i,j=e.length,k=Kinetic.Util._capitalize,l=a+k(d),m=b+k(d);c.prototype[l]=function()***REMOVED***var a=***REMOVED******REMOVED***;for(h=0;j>h;h++)i=e[h],a[i]=this.getAttr(d+k(i));return a***REMOVED***,c.prototype[m]=function(a)***REMOVED***var b,c=this.attrs[d];f&&(a=f.call(this,a));for(b in a)this._setAttr(d+k(b),a[b]);return this._fireChangeEvent(d,c,a),g&&g.call(this),this***REMOVED***,this.addOverloadedGetterSetter(c,d)***REMOVED***,addOverloadedGetterSetter:function(c,d)***REMOVED***var e=Kinetic.Util._capitalize(d),f=b+e,g=a+e;c.prototype[d]=function()***REMOVED***return arguments.length?(this[f](arguments[0]),this):this[g]()***REMOVED******REMOVED***,backCompat:function(a,b)***REMOVED***var c;for(c in b)a.prototype[c]=a.prototype[b[c]]***REMOVED***,afterSetFilter:function()***REMOVED***this._filterUpToDate=!1***REMOVED******REMOVED***,Kinetic.Validators=***REMOVED***RGBComponent:function(a)***REMOVED***return a>255?255:0>a?0:Math.round(a)***REMOVED***,alphaComponent:function(a)***REMOVED***return a>1?1:1e-4>a?1e-4:a***REMOVED******REMOVED******REMOVED***(),function()***REMOVED***var a="absoluteOpacity",b="absoluteTransform",c="Change",d="children",e=".",f="",g="get",h="id",i="kinetic",j="listening",k="mouseenter",l="mouseleave",m="name",n="set",o="Shape",p=" ",q="stage",r="transform",s="Stage",t="visible",u=["id"],v=["xChange.kinetic","yChange.kinetic","scaleXChange.kinetic","scaleYChange.kinetic","skewXChange.kinetic","skewYChange.kinetic","rotationChange.kinetic","offsetXChange.kinetic","offsetYChange.kinetic","transformsEnabledChange.kinetic"].join(p);Kinetic.Util.addMethods(Kinetic.Node,***REMOVED***_init:function(c)***REMOVED***var d=this;this._id=Kinetic.idCounter++,this.eventListeners=***REMOVED******REMOVED***,this.attrs=***REMOVED******REMOVED***,this._cache=***REMOVED******REMOVED***,this._filterUpToDate=!1,this.setAttrs(c),this.on(v,function()***REMOVED***this._clearCache(r),d._clearSelfAndDescendantCache(b)***REMOVED***),this.on("visibleChange.kinetic",function()***REMOVED***d._clearSelfAndDescendantCache(t)***REMOVED***),this.on("listeningChange.kinetic",function()***REMOVED***d._clearSelfAndDescendantCache(j)***REMOVED***),this.on("opacityChange.kinetic",function()***REMOVED***d._clearSelfAndDescendantCache(a)***REMOVED***)***REMOVED***,_clearCache:function(a)***REMOVED***a?delete this._cache[a]:this._cache=***REMOVED******REMOVED******REMOVED***,_getCache:function(a,b)***REMOVED***var c=this._cache[a];return void 0===c&&(this._cache[a]=b.call(this)),this._cache[a]***REMOVED***,_clearSelfAndDescendantCache:function(a)***REMOVED***this._clearCache(a),this.children&&this.getChildren().each(function(b)***REMOVED***b._clearSelfAndDescendantCache(a)***REMOVED***)***REMOVED***,clearCache:function()***REMOVED***return delete this._cache.canvas,this._filterUpToDate=!1,this***REMOVED***,cache:function(a)***REMOVED******REMOVED***var b=a||***REMOVED******REMOVED***,c=b.x||0,d=b.y||0,e=b.width||this.width(),f=b.height||this.height(),g=b.drawBorder||!1;this.getLayer()***REMOVED***if(0===e||0===f)return void Kinetic.Util.warn("Width or height of caching configuration equals 0. Cache is ignored.");var h=new Kinetic.SceneCanvas(***REMOVED***pixelRatio:1,width:e,height:f***REMOVED***),i=new Kinetic.SceneCanvas(***REMOVED***pixelRatio:1,width:e,height:f***REMOVED***),j=new Kinetic.HitCanvas(***REMOVED***width:e,height:f***REMOVED***),k=(this.transformsEnabled(),this.x(),this.y(),h.getContext()),l=j.getContext();return this.clearCache(),k.save(),l.save(),g&&(k.save(),k.beginPath(),k.rect(0,0,e,f),k.closePath(),k.setAttr("strokeStyle","red"),k.setAttr("lineWidth",5),k.stroke(),k.restore()),k.translate(-1*c,-1*d),l.translate(-1*c,-1*d),"Shape"===this.nodeType&&(k.translate(-1*this.x(),-1*this.y()),l.translate(-1*this.x(),-1*this.y())),this.drawScene(h,this),this.drawHit(j,this),k.restore(),l.restore(),this._cache.canvas=***REMOVED***scene:h,filter:i,hit:j***REMOVED***,this***REMOVED***,_drawCachedSceneCanvas:function(a)***REMOVED***a.save(),this.getLayer()._applyTransform(this,a),a.drawImage(this._getCachedSceneCanvas()._canvas,0,0),a.restore()***REMOVED***,_getCachedSceneCanvas:function()***REMOVED***var a,b,c,d,e=this.filters(),f=this._cache.canvas,g=f.scene,h=f.filter,i=h.getContext();if(e)***REMOVED***if(!this._filterUpToDate)***REMOVED***try***REMOVED***for(a=e.length,i.clear(),i.drawImage(g._canvas,0,0),b=i.getImageData(0,0,h.getWidth(),h.getHeight()),c=0;a>c;c++)d=e[c],d.call(this,b),i.putImageData(b,0,0)***REMOVED***catch(j)***REMOVED***Kinetic.Util.warn("Unable to apply filter. "+j.message)***REMOVED***this._filterUpToDate=!0***REMOVED***return h***REMOVED***return g***REMOVED***,_drawCachedHitCanvas:function(a)***REMOVED***var b=this._cache.canvas,c=b.hit;a.save(),this.getLayer()._applyTransform(this,a),a.drawImage(c._canvas,0,0),a.restore()***REMOVED***,on:function(a,b)***REMOVED***var c,d,g,h,i,j=a.split(p),k=j.length;for(c=0;k>c;c++)d=j[c],g=d.split(e),h=g[0],i=g[1]||f,this.eventListeners[h]||(this.eventListeners[h]=[]),this.eventListeners[h].push(***REMOVED***name:i,handler:b***REMOVED***);return this***REMOVED***,off:function(a)***REMOVED***var b,c,d,f,g,h,i=a.split(p),j=i.length;for(b=0;j>b;b++)if(d=i[b],f=d.split(e),g=f[0],h=f[1],g)this.eventListeners[g]&&this._off(g,h);else for(c in this.eventListeners)this._off(c,h);return this***REMOVED***,dispatchEvent:function(a)***REMOVED***var b=***REMOVED***target:this,type:a.type,evt:a***REMOVED***;this.fire(a.type,b)***REMOVED***,addEventListener:function(a,b)***REMOVED***this.on(a,function(a)***REMOVED***b.call(this,a.evt)***REMOVED***)***REMOVED***,remove:function()***REMOVED***var c=this.getParent();return c&&c.children&&(c.children.splice(this.index,1),c._setChildrenIndices(),delete this.parent),this._clearSelfAndDescendantCache(q),this._clearSelfAndDescendantCache(b),this._clearSelfAndDescendantCache(t),this._clearSelfAndDescendantCache(j),this._clearSelfAndDescendantCache(a),this***REMOVED***,destroy:function()***REMOVED***Kinetic._removeId(this.getId()),Kinetic._removeName(this.getName(),this._id),this.remove()***REMOVED***,getAttr:function(a)***REMOVED***var b=g+Kinetic.Util._capitalize(a);return Kinetic.Util._isFunction(this[b])?this[b]():this.attrs[a]***REMOVED***,getAncestors:function()***REMOVED***for(var a=this.getParent(),b=new Kinetic.Collection;a;)b.push(a),a=a.getParent();return b***REMOVED***,getAttrs:function()***REMOVED***return this.attrs||***REMOVED******REMOVED******REMOVED***,setAttrs:function(a)***REMOVED***var b,c;if(a)for(b in a)b===d||(c=n+Kinetic.Util._capitalize(b),Kinetic.Util._isFunction(this[c])?this[c](a[b]):this._setAttr(b,a[b]));return this***REMOVED***,isListening:function()***REMOVED***return this._getCache(j,this._isListening)***REMOVED***,_isListening:function()***REMOVED***var a=this.getListening(),b=this.getParent();return"inherit"===a?b?b.isListening():!0:a***REMOVED***,isVisible:function()***REMOVED***return this._getCache(t,this._isVisible)***REMOVED***,_isVisible:function()***REMOVED***var a=this.getVisible(),b=this.getParent();return"inherit"===a?b?b.isVisible():!0:a***REMOVED***,shouldDrawHit:function()***REMOVED***var a=this.getLayer();return a&&a.hitGraphEnabled()&&this.isListening()&&this.isVisible()&&!Kinetic.isDragging()***REMOVED***,show:function()***REMOVED***return this.setVisible(!0),this***REMOVED***,hide:function()***REMOVED***return this.setVisible(!1),this***REMOVED***,getZIndex:function()***REMOVED***return this.index||0***REMOVED***,getAbsoluteZIndex:function()***REMOVED***function a(i)***REMOVED***for(b=[],c=i.length,d=0;c>d;d++)e=i[d],h++,e.nodeType!==o&&(b=b.concat(e.getChildren().toArray())),e._id===g._id&&(d=c);b.length>0&&b[0].getDepth()<=f&&a(b)***REMOVED***var b,c,d,e,f=this.getDepth(),g=this,h=0;return g.nodeType!==s&&a(g.getStage().getChildren()),h***REMOVED***,getDepth:function()***REMOVED***for(var a=0,b=this.parent;b;)a++,b=b.parent;return a***REMOVED***,setPosition:function(a)***REMOVED***return this.setX(a.x),this.setY(a.y),this***REMOVED***,getPosition:function()***REMOVED***return***REMOVED***x:this.getX(),y:this.getY()***REMOVED******REMOVED***,getAbsolutePosition:function()***REMOVED***var a=this.getAbsoluteTransform().getMatrix(),b=new Kinetic.Transform,c=this.offset();return b.m=a.slice(),b.translate(c.x,c.y),b.getTranslation()***REMOVED***,setAbsolutePosition:function(a)***REMOVED***var b,c=this._clearTransform();return this.attrs.x=c.x,this.attrs.y=c.y,delete c.x,delete c.y,b=this.getAbsoluteTransform(),b.invert(),b.translate(a.x,a.y),a=***REMOVED***x:this.attrs.x+b.getTranslation().x,y:this.attrs.y+b.getTranslation().y***REMOVED***,this.setPosition(***REMOVED***x:a.x,y:a.y***REMOVED***),this._setTransform(c),this***REMOVED***,_setTransform:function(a)***REMOVED***var c;for(c in a)this.attrs[c]=a[c];this._clearCache(r),this._clearSelfAndDescendantCache(b)***REMOVED***,_clearTransform:function()***REMOVED***var a=***REMOVED***x:this.getX(),y:this.getY(),rotation:this.getRotation(),scaleX:this.getScaleX(),scaleY:this.getScaleY(),offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),skewX:this.getSkewX(),skewY:this.getSkewY()***REMOVED***;return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,this._clearCache(r),this._clearSelfAndDescendantCache(b),a***REMOVED***,move:function(a)***REMOVED***var b=a.x,c=a.y,d=this.getX(),e=this.getY();return void 0!==b&&(d+=b),void 0!==c&&(e+=c),this.setPosition(***REMOVED***x:d,y:e***REMOVED***),this***REMOVED***,_eachAncestorReverse:function(a,b)***REMOVED***var c,d,e=[],f=this.getParent();if(b&&b._id===this._id)return a(this),!0;for(e.unshift(this);f&&(!b||f._id!==b._id);)e.unshift(f),f=f.parent;for(c=e.length,d=0;c>d;d++)a(e[d])***REMOVED***,rotate:function(a)***REMOVED***return this.setRotation(this.getRotation()+a),this***REMOVED***,moveToTop:function()***REMOVED***if(!this.parent)return void Kinetic.Util.warn("Node has no parent. moveToTop function is ignored.");var a=this.index;return this.parent.children.splice(a,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0***REMOVED***,moveUp:function()***REMOVED***if(!this.parent)return void Kinetic.Util.warn("Node has no parent. moveUp function is ignored.");var a=this.index,b=this.parent.getChildren().length;return b-1>a?(this.parent.children.splice(a,1),this.parent.children.splice(a+1,0,this),this.parent._setChildrenIndices(),!0):!1***REMOVED***,moveDown:function()***REMOVED***if(!this.parent)return void Kinetic.Util.warn("Node has no parent. moveDown function is ignored.");var a=this.index;return a>0?(this.parent.children.splice(a,1),this.parent.children.splice(a-1,0,this),this.parent._setChildrenIndices(),!0):!1***REMOVED***,moveToBottom:function()***REMOVED***if(!this.parent)return void Kinetic.Util.warn("Node has no parent. moveToBottom function is ignored.");var a=this.index;return a>0?(this.parent.children.splice(a,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1***REMOVED***,setZIndex:function(a)***REMOVED***if(!this.parent)return void Kinetic.Util.warn("Node has no parent. zIndex parameter is ignored.");var b=this.index;return this.parent.children.splice(b,1),this.parent.children.splice(a,0,this),this.parent._setChildrenIndices(),this***REMOVED***,getAbsoluteOpacity:function()***REMOVED***return this._getCache(a,this._getAbsoluteOpacity)***REMOVED***,_getAbsoluteOpacity:function()***REMOVED***var a=this.getOpacity();return this.getParent()&&(a*=this.getParent().getAbsoluteOpacity()),a***REMOVED***,moveTo:function(a)***REMOVED***return Kinetic.Node.prototype.remove.call(this),a.add(this),this***REMOVED***,toObject:function()***REMOVED***var a,b,c,d,e=Kinetic.Util,f=***REMOVED******REMOVED***,g=this.getAttrs();f.attrs=***REMOVED******REMOVED***;for(a in g)b=g[a],e._isFunction(b)||e._isElement(b)||e._isObject(b)&&e._hasMethods(b)||(c=this[a],delete g[a],d=c?c.call(this):null,g[a]=b,d!==b&&(f.attrs[a]=b));return f.className=this.getClassName(),f***REMOVED***,toJSON:function()***REMOVED***return JSON.stringify(this.toObject())***REMOVED***,getParent:function()***REMOVED***return this.parent***REMOVED***,getLayer:function()***REMOVED***var a=this.getParent();return a?a.getLayer():null***REMOVED***,getStage:function()***REMOVED***return this._getCache(q,this._getStage)***REMOVED***,_getStage:function()***REMOVED***var a=this.getParent();return a?a.getStage():void 0***REMOVED***,fire:function(a,b,c)***REMOVED***return c?this._fireAndBubble(a,b||***REMOVED******REMOVED***):this._fire(a,b||***REMOVED******REMOVED***),this***REMOVED***,getAbsoluteTransform:function(a)***REMOVED***return a?this._getAbsoluteTransform(a):this._getCache(b,this._getAbsoluteTransform)***REMOVED***,_getAbsoluteTransform:function(a)***REMOVED***var b,c,d=new Kinetic.Transform;return this._eachAncestorReverse(function(a)***REMOVED***b=a.transformsEnabled(),c=a.getTransform(),"all"===b?d.multiply(c):"position"===b&&d.translate(a.x(),a.y())***REMOVED***,a),d***REMOVED***,getTransform:function()***REMOVED***return this._getCache(r,this._getTransform)***REMOVED***,_getTransform:function()***REMOVED***var a=new Kinetic.Transform,b=this.getX(),c=this.getY(),d=Kinetic.getAngle(this.getRotation()),e=this.getScaleX(),f=this.getScaleY(),g=this.getSkewX(),h=this.getSkewY(),i=this.getOffsetX(),j=this.getOffsetY();return(0!==b||0!==c)&&a.translate(b,c),0!==d&&a.rotate(d),(0!==g||0!==h)&&a.skew(g,h),(1!==e||1!==f)&&a.scale(e,f),(0!==i||0!==j)&&a.translate(-1*i,-1*j),a***REMOVED***,clone:function(a)***REMOVED***var b,c,d,e,f,g=this.getClassName(),h=Kinetic.Util.cloneObject(this.attrs);for(var j in u)***REMOVED***var k=u[j];delete h[k]***REMOVED***for(b in a)h[b]=a[b];var l=new Kinetic[g](h);for(b in this.eventListeners)for(c=this.eventListeners[b],d=c.length,e=0;d>e;e++)f=c[e],f.name.indexOf(i)<0&&(l.eventListeners[b]||(l.eventListeners[b]=[]),l.eventListeners[b].push(f));return l***REMOVED***,toDataURL:function(a)***REMOVED***a=a||***REMOVED******REMOVED***;var b=a.mimeType||null,c=a.quality||null,d=this.getStage(),e=a.x||0,f=a.y||0,g=new Kinetic.SceneCanvas(***REMOVED***width:a.width||this.getWidth()||(d?d.getWidth():0),height:a.height||this.getHeight()||(d?d.getHeight():0),pixelRatio:1***REMOVED***),h=g.getContext();return h.save(),(e||f)&&h.translate(-1*e,-1*f),this.drawScene(g),h.restore(),g.toDataURL(b,c)***REMOVED***,toImage:function(a)***REMOVED***Kinetic.Util._getImage(this.toDataURL(a),function(b)***REMOVED***a.callback(b)***REMOVED***)***REMOVED***,setSize:function(a)***REMOVED***return this.setWidth(a.width),this.setHeight(a.height),this***REMOVED***,getSize:function()***REMOVED***return***REMOVED***width:this.getWidth(),height:this.getHeight()***REMOVED******REMOVED***,getWidth:function()***REMOVED***return this.attrs.width||0***REMOVED***,getHeight:function()***REMOVED***return this.attrs.height||0***REMOVED***,getClassName:function()***REMOVED***return this.className||this.nodeType***REMOVED***,getType:function()***REMOVED***return this.nodeType***REMOVED***,getDragDistance:function()***REMOVED***return void 0!==this.attrs.dragDistance?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():Kinetic.dragDistance***REMOVED***,_get:function(a)***REMOVED***return this.nodeType===a?[this]:[]***REMOVED***,_off:function(a,b)***REMOVED***var c,d,e=this.eventListeners[a];for(c=0;c<e.length;c++)if(d=e[c].name,!("kinetic"===d&&"kinetic"!==b||b&&d!==b))***REMOVED***if(e.splice(c,1),0===e.length)***REMOVED***delete this.eventListeners[a];break***REMOVED***c--***REMOVED******REMOVED***,_fireChangeEvent:function(a,b,d)***REMOVED***this._fire(a+c,***REMOVED***oldVal:b,newVal:d***REMOVED***)***REMOVED***,setId:function(a)***REMOVED***var b=this.getId();return Kinetic._removeId(b),Kinetic._addId(this,a),this._setAttr(h,a),this***REMOVED***,setName:function(a)***REMOVED***var b=this.getName();return Kinetic._removeName(b,this._id),Kinetic._addName(this,a),this._setAttr(m,a),this***REMOVED***,setAttr:function()***REMOVED***var a=Array.prototype.slice.call(arguments),b=a[0],c=a[1],d=n+Kinetic.Util._capitalize(b),e=this[d];
return Kinetic.Util._isFunction(e)?e.call(this,c):this._setAttr(b,c),this***REMOVED***,_setAttr:function(a,b)***REMOVED***var c;void 0!==b&&(c=this.attrs[a],this.attrs[a]=b,this._fireChangeEvent(a,c,b))***REMOVED***,_setComponentAttr:function(a,b,c)***REMOVED***var d;void 0!==c&&(d=this.attrs[a],d||(this.attrs[a]=this.getAttr(a)),this.attrs[a][b]=c,this._fireChangeEvent(a,d,c))***REMOVED***,_fireAndBubble:function(a,b,c)***REMOVED***var d=!0;b&&this.nodeType===o&&(b.target=this),a===k&&c&&this._id===c._id?d=!1:a===l&&c&&this._id===c._id&&(d=!1),d&&(this._fire(a,b),b&&!b.cancelBubble&&this.parent&&(c&&c.parent?this._fireAndBubble.call(this.parent,a,b,c.parent):this._fireAndBubble.call(this.parent,a,b)))***REMOVED***,_fire:function(a,b)***REMOVED***var c,d=this.eventListeners[a];if(b.type=a,d)for(c=0;c<d.length;c++)d[c].handler.call(this,b)***REMOVED***,draw:function()***REMOVED***return this.drawScene(),this.drawHit(),this***REMOVED******REMOVED***),Kinetic.Node.create=function(a,b)***REMOVED***return this._createNode(JSON.parse(a),b)***REMOVED***,Kinetic.Node._createNode=function(a,b)***REMOVED***var c,d,e,f=Kinetic.Node.prototype.getClassName.call(a),g=a.children;if(b&&(a.attrs.container=b),c=new Kinetic[f](a.attrs),g)for(d=g.length,e=0;d>e;e++)c.add(this._createNode(g[e]));return c***REMOVED***,Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"position"),Kinetic.Factory.addGetterSetter(Kinetic.Node,"x",0),Kinetic.Factory.addGetterSetter(Kinetic.Node,"y",0),Kinetic.Factory.addGetterSetter(Kinetic.Node,"opacity",1),Kinetic.Factory.addGetter(Kinetic.Node,"name"),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"name"),Kinetic.Factory.addGetter(Kinetic.Node,"id"),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"id"),Kinetic.Factory.addGetterSetter(Kinetic.Node,"rotation",0),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Node,"scale",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Node,"scaleX",1),Kinetic.Factory.addGetterSetter(Kinetic.Node,"scaleY",1),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Node,"skew",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Node,"skewX",0),Kinetic.Factory.addGetterSetter(Kinetic.Node,"skewY",0),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Node,"offset",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Node,"offsetX",0),Kinetic.Factory.addGetterSetter(Kinetic.Node,"offsetY",0),Kinetic.Factory.addSetter(Kinetic.Node,"dragDistance"),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"dragDistance"),Kinetic.Factory.addSetter(Kinetic.Node,"width",0),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"width"),Kinetic.Factory.addSetter(Kinetic.Node,"height",0),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"height"),Kinetic.Factory.addGetterSetter(Kinetic.Node,"listening","inherit"),Kinetic.Factory.addGetterSetter(Kinetic.Node,"filters",void 0,function(a)***REMOVED***return this._filterUpToDate=!1,a***REMOVED***),Kinetic.Factory.addGetterSetter(Kinetic.Node,"visible","inherit"),Kinetic.Factory.addGetterSetter(Kinetic.Node,"transformsEnabled","all"),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"size"),Kinetic.Factory.backCompat(Kinetic.Node,***REMOVED***rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"***REMOVED***),Kinetic.Collection.mapMethods(Kinetic.Node)***REMOVED***(),function()***REMOVED***Kinetic.Filters.Grayscale=function(a)***REMOVED***var b,c,d=a.data,e=d.length;for(b=0;e>b;b+=4)c=.34*d[b]+.5*d[b+1]+.16*d[b+2],d[b]=c,d[b+1]=c,d[b+2]=c***REMOVED******REMOVED***(),function()***REMOVED***Kinetic.Filters.Brighten=function(a)***REMOVED***var b,c=255*this.brightness(),d=a.data,e=d.length;for(b=0;e>b;b+=4)d[b]+=c,d[b+1]+=c,d[b+2]+=c***REMOVED***,Kinetic.Factory.addGetterSetter(Kinetic.Node,"brightness",0,null,Kinetic.Factory.afterSetFilter)***REMOVED***(),function()***REMOVED***Kinetic.Filters.Invert=function(a)***REMOVED***var b,c=a.data,d=c.length;for(b=0;d>b;b+=4)c[b]=255-c[b],c[b+1]=255-c[b+1],c[b+2]=255-c[b+2]***REMOVED******REMOVED***(),function()***REMOVED***function a()***REMOVED***this.r=0,this.g=0,this.b=0,this.a=0,this.next=null***REMOVED***function b(b,e)***REMOVED***var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D=b.data,E=b.width,F=b.height,G=e+e+1,H=E-1,I=F-1,J=e+1,K=J*(J+1)/2,L=new a,M=null,N=L,O=null,P=null,Q=c[e],R=d[e];for(h=1;G>h;h++)N=N.next=new a,h==J&&(M=N);for(N.next=L,l=k=0,g=0;F>g;g++)***REMOVED***for(u=v=w=x=m=n=o=p=0,q=J*(y=D[k]),r=J*(z=D[k+1]),s=J*(A=D[k+2]),t=J*(B=D[k+3]),m+=K*y,n+=K*z,o+=K*A,p+=K*B,N=L,h=0;J>h;h++)N.r=y,N.g=z,N.b=A,N.a=B,N=N.next;for(h=1;J>h;h++)i=k+((h>H?H:h)<<2),m+=(N.r=y=D[i])*(C=J-h),n+=(N.g=z=D[i+1])*C,o+=(N.b=A=D[i+2])*C,p+=(N.a=B=D[i+3])*C,u+=y,v+=z,w+=A,x+=B,N=N.next;for(O=L,P=M,f=0;E>f;f++)D[k+3]=B=p*Q>>R,0!==B?(B=255/B,D[k]=(m*Q>>R)*B,D[k+1]=(n*Q>>R)*B,D[k+2]=(o*Q>>R)*B):D[k]=D[k+1]=D[k+2]=0,m-=q,n-=r,o-=s,p-=t,q-=O.r,r-=O.g,s-=O.b,t-=O.a,i=l+((i=f+e+1)<H?i:H)<<2,u+=O.r=D[i],v+=O.g=D[i+1],w+=O.b=D[i+2],x+=O.a=D[i+3],m+=u,n+=v,o+=w,p+=x,O=O.next,q+=y=P.r,r+=z=P.g,s+=A=P.b,t+=B=P.a,u-=y,v-=z,w-=A,x-=B,P=P.next,k+=4;l+=E***REMOVED***for(f=0;E>f;f++)***REMOVED***for(v=w=x=u=n=o=p=m=0,k=f<<2,q=J*(y=D[k]),r=J*(z=D[k+1]),s=J*(A=D[k+2]),t=J*(B=D[k+3]),m+=K*y,n+=K*z,o+=K*A,p+=K*B,N=L,h=0;J>h;h++)N.r=y,N.g=z,N.b=A,N.a=B,N=N.next;for(j=E,h=1;e>=h;h++)k=j+f<<2,m+=(N.r=y=D[k])*(C=J-h),n+=(N.g=z=D[k+1])*C,o+=(N.b=A=D[k+2])*C,p+=(N.a=B=D[k+3])*C,u+=y,v+=z,w+=A,x+=B,N=N.next,I>h&&(j+=E);for(k=f,O=L,P=M,g=0;F>g;g++)i=k<<2,D[i+3]=B=p*Q>>R,B>0?(B=255/B,D[i]=(m*Q>>R)*B,D[i+1]=(n*Q>>R)*B,D[i+2]=(o*Q>>R)*B):D[i]=D[i+1]=D[i+2]=0,m-=q,n-=r,o-=s,p-=t,q-=O.r,r-=O.g,s-=O.b,t-=O.a,i=f+((i=g+J)<I?i:I)*E<<2,m+=u+=O.r=D[i],n+=v+=O.g=D[i+1],o+=w+=O.b=D[i+2],p+=x+=O.a=D[i+3],O=O.next,q+=y=P.r,r+=z=P.g,s+=A=P.b,t+=B=P.a,u-=y,v-=z,w-=A,x-=B,P=P.next,k+=E***REMOVED******REMOVED***var c=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],d=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];Kinetic.Filters.Blur=function(a)***REMOVED***var c=Math.round(this.blurRadius());c>0&&b(a,c)***REMOVED***,Kinetic.Factory.addGetterSetter(Kinetic.Node,"blurRadius",0,null,Kinetic.Factory.afterSetFilter)***REMOVED***(),function()***REMOVED***function a(a,b,c)***REMOVED***var d=4*(c*a.width+b),e=[];return e.push(a.data[d++],a.data[d++],a.data[d++],a.data[d++]),e***REMOVED***function b(a,b)***REMOVED***return Math.sqrt(Math.pow(a[0]-b[0],2)+Math.pow(a[1]-b[1],2)+Math.pow(a[2]-b[2],2))***REMOVED***function c(a)***REMOVED***for(var b=[0,0,0],c=0;c<a.length;c++)b[0]+=a[c][0],b[1]+=a[c][1],b[2]+=a[c][2];return b[0]/=a.length,b[1]/=a.length,b[2]/=a.length,b***REMOVED***function d(d,e)***REMOVED***var f=a(d,0,0),g=a(d,d.width-1,0),h=a(d,0,d.height-1),i=a(d,d.width-1,d.height-1),j=e||10;if(b(f,g)<j&&b(g,i)<j&&b(i,h)<j&&b(h,f)<j)***REMOVED***for(var k=c([g,f,i,h]),l=[],m=0;m<d.width*d.height;m++)***REMOVED***var n=b(k,[d.data[4*m],d.data[4*m+1],d.data[4*m+2]]);l[m]=j>n?0:255***REMOVED***return l***REMOVED******REMOVED***function e(a,b)***REMOVED***for(var c=0;c<a.width*a.height;c++)a.data[4*c+3]=b[c]***REMOVED***function f(a,b,c)***REMOVED***for(var d=[1,1,1,1,0,1,1,1,1],e=Math.round(Math.sqrt(d.length)),f=Math.floor(e/2),g=[],h=0;c>h;h++)for(var i=0;b>i;i++)***REMOVED***for(var j=h*b+i,k=0,l=0;e>l;l++)for(var m=0;e>m;m++)***REMOVED***var n=h+l-f,o=i+m-f;if(n>=0&&c>n&&o>=0&&b>o)***REMOVED***var p=n*b+o,q=d[l*e+m];k+=a[p]*q***REMOVED******REMOVED***g[j]=2040===k?255:0***REMOVED***return g***REMOVED***function g(a,b,c)***REMOVED***for(var d=[1,1,1,1,1,1,1,1,1],e=Math.round(Math.sqrt(d.length)),f=Math.floor(e/2),g=[],h=0;c>h;h++)for(var i=0;b>i;i++)***REMOVED***for(var j=h*b+i,k=0,l=0;e>l;l++)for(var m=0;e>m;m++)***REMOVED***var n=h+l-f,o=i+m-f;if(n>=0&&c>n&&o>=0&&b>o)***REMOVED***var p=n*b+o,q=d[l*e+m];k+=a[p]*q***REMOVED******REMOVED***g[j]=k>=1020?255:0***REMOVED***return g***REMOVED***function h(a,b,c)***REMOVED***for(var d=[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9],e=Math.round(Math.sqrt(d.length)),f=Math.floor(e/2),g=[],h=0;c>h;h++)for(var i=0;b>i;i++)***REMOVED***for(var j=h*b+i,k=0,l=0;e>l;l++)for(var m=0;e>m;m++)***REMOVED***var n=h+l-f,o=i+m-f;if(n>=0&&c>n&&o>=0&&b>o)***REMOVED***var p=n*b+o,q=d[l*e+m];k+=a[p]*q***REMOVED******REMOVED***g[j]=k***REMOVED***return g***REMOVED***Kinetic.Filters.Mask=function(a)***REMOVED***var b=this.threshold(),c=d(a,b);return c&&(c=f(c,a.width,a.height),c=g(c,a.width,a.height),c=h(c,a.width,a.height),e(a,c)),a***REMOVED***,Kinetic.Factory.addGetterSetter(Kinetic.Node,"threshold",0,null,Kinetic.Factory.afterSetFilter)***REMOVED***(),function()***REMOVED***Kinetic.Filters.RGB=function(a)***REMOVED***var b,c,d=a.data,e=d.length,f=this.red(),g=this.green(),h=this.blue();for(b=0;e>b;b+=4)c=(.34*d[b]+.5*d[b+1]+.16*d[b+2])/255,d[b]=c*f,d[b+1]=c*g,d[b+2]=c*h,d[b+3]=d[b+3]***REMOVED***,Kinetic.Factory.addGetterSetter(Kinetic.Node,"red",0,function(a)***REMOVED***return this._filterUpToDate=!1,a>255?255:0>a?0:Math.round(a)***REMOVED***),Kinetic.Factory.addGetterSetter(Kinetic.Node,"green",0,function(a)***REMOVED***return this._filterUpToDate=!1,a>255?255:0>a?0:Math.round(a)***REMOVED***),Kinetic.Factory.addGetterSetter(Kinetic.Node,"blue",0,Kinetic.Validators.RGBComponent,Kinetic.Factory.afterSetFilter)***REMOVED***(),function()***REMOVED***Kinetic.Filters.HSV=function(a)***REMOVED***var b,c,d,e,f,g=a.data,h=g.length,i=Math.pow(2,this.value()),j=Math.pow(2,this.saturation()),k=Math.abs(this.hue()+360)%360,l=i*j*Math.cos(k*Math.PI/180),m=i*j*Math.sin(k*Math.PI/180),n=.299*i+.701*l+.167*m,o=.587*i-.587*l+.33*m,p=.114*i-.114*l-.497*m,q=.299*i-.299*l-.328*m,r=.587*i+.413*l+.035*m,s=.114*i-.114*l+.293*m,t=.299*i-.3*l+1.25*m,u=.587*i-.586*l-1.05*m,v=.114*i+.886*l-.2*m;for(b=0;h>b;b+=4)c=g[b+0],d=g[b+1],e=g[b+2],f=g[b+3],g[b+0]=n*c+o*d+p*e,g[b+1]=q*c+r*d+s*e,g[b+2]=t*c+u*d+v*e,g[b+3]=f***REMOVED***,Kinetic.Factory.addGetterSetter(Kinetic.Node,"hue",0,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"saturation",0,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"value",0,null,Kinetic.Factory.afterSetFilter)***REMOVED***(),function()***REMOVED***Kinetic.Factory.addGetterSetter(Kinetic.Node,"hue",0,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"saturation",0,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"luminance",0,null,Kinetic.Factory.afterSetFilter),Kinetic.Filters.HSL=function(a)***REMOVED***var b,c,d,e,f,g=a.data,h=g.length,i=1,j=Math.pow(2,this.saturation()),k=Math.abs(this.hue()+360)%360,l=127*this.luminance(),m=i*j*Math.cos(k*Math.PI/180),n=i*j*Math.sin(k*Math.PI/180),o=.299*i+.701*m+.167*n,p=.587*i-.587*m+.33*n,q=.114*i-.114*m-.497*n,r=.299*i-.299*m-.328*n,s=.587*i+.413*m+.035*n,t=.114*i-.114*m+.293*n,u=.299*i-.3*m+1.25*n,v=.587*i-.586*m-1.05*n,w=.114*i+.886*m-.2*n;for(b=0;h>b;b+=4)c=g[b+0],d=g[b+1],e=g[b+2],f=g[b+3],g[b+0]=o*c+p*d+q*e+l,g[b+1]=r*c+s*d+t*e+l,g[b+2]=u*c+v*d+w*e+l,g[b+3]=f***REMOVED******REMOVED***(),function()***REMOVED***Kinetic.Filters.Emboss=function(a)***REMOVED***var b=10*this.embossStrength(),c=255*this.embossWhiteLevel(),d=this.embossDirection(),e=this.embossBlend(),f=0,g=0,h=a.data,i=a.width,j=a.height,k=4*i,l=j;switch(d)***REMOVED***case"top-left":f=-1,g=-1;break;case"top":f=-1,g=0;break;case"top-right":f=-1,g=1;break;case"right":f=0,g=1;break;case"bottom-right":f=1,g=1;break;case"bottom":f=1,g=0;break;case"bottom-left":f=1,g=-1;break;case"left":f=0,g=-1***REMOVED***do***REMOVED***var m=(l-1)*k,n=f;1>l+n&&(n=0),l+n>j&&(n=0);var o=(l-1+n)*i*4,p=i;do***REMOVED***var q=m+4*(p-1),r=g;1>p+r&&(r=0),p+r>i&&(r=0);var s=o+4*(p-1+r),t=h[q]-h[s],u=h[q+1]-h[s+1],v=h[q+2]-h[s+2],w=t,x=w>0?w:-w,y=u>0?u:-u,z=v>0?v:-v;if(y>x&&(w=u),z>x&&(w=v),w*=b,e)***REMOVED***var A=h[q]+w,B=h[q+1]+w,C=h[q+2]+w;h[q]=A>255?255:0>A?0:A,h[q+1]=B>255?255:0>B?0:B,h[q+2]=C>255?255:0>C?0:C***REMOVED***else***REMOVED***var D=c-w;0>D?D=0:D>255&&(D=255),h[q]=h[q+1]=h[q+2]=D***REMOVED******REMOVED***while(--p)***REMOVED***while(--l)***REMOVED***,Kinetic.Factory.addGetterSetter(Kinetic.Node,"embossStrength",.5,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"embossWhiteLevel",.5,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"embossDirection","top-left",null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"embossBlend",!1,null,Kinetic.Factory.afterSetFilter)***REMOVED***(),function()***REMOVED***function a(a,b,c,d,e)***REMOVED***var f,g=c-b,h=e-d;return 0===g?d+h/2:0===h?d:(f=(a-b)/g,f=h*f+d)***REMOVED***Kinetic.Filters.Enhance=function(b)***REMOVED***var c,d,e,f,g=b.data,h=g.length,i=g[0],j=i,k=g[1],l=k,m=g[2],n=m,o=g[3],p=o,q=this.enhance();if(0!==q)***REMOVED***for(f=0;h>f;f+=4)c=g[f+0],i>c?i=c:c>j&&(j=c),d=g[f+1],k>d?k=d:d>l&&(l=d),e=g[f+2],m>e?m=e:e>n&&(n=e);j===i&&(j=255,i=0),l===k&&(l=255,k=0),n===m&&(n=255,m=0),p===o&&(p=255,o=0);var r,s,t,u,v,w,x,y,z,A,B,C;for(q>0?(s=j+q*(255-j),t=i-q*(i-0),v=l+q*(255-l),w=k-q*(k-0),y=n+q*(255-n),C=m-q*(m-0),B=p+q*(255-p),z=o-q*(o-0)):(r=.5*(j+i),s=j+q*(j-r),t=i+q*(i-r),u=.5*(l+k),v=l+q*(l-u),w=k+q*(k-u),x=.5*(n+m),y=n+q*(n-x),C=m+q*(m-x),A=.5*(p+o),B=p+q*(p-A),z=o+q*(o-A)),f=0;h>f;f+=4)g[f+0]=a(g[f+0],i,j,t,s),g[f+1]=a(g[f+1],k,l,w,v),g[f+2]=a(g[f+2],m,n,C,y)***REMOVED******REMOVED***,Kinetic.Factory.addGetterSetter(Kinetic.Node,"enhance",0,null,Kinetic.Factory.afterSetFilter)***REMOVED***(),function()***REMOVED***Kinetic.Filters.Posterize=function(a)***REMOVED***var b,c=Math.round(254*this.levels())+1,d=a.data,e=d.length,f=255/c;for(b=0;e>b;b+=1)d[b]=Math.floor(d[b]/f)*f***REMOVED***,Kinetic.Factory.addGetterSetter(Kinetic.Node,"levels",.5,null,Kinetic.Factory.afterSetFilter)***REMOVED***(),function()***REMOVED***Kinetic.Filters.Noise=function(a)***REMOVED***var b,c=255*this.noise(),d=a.data,e=d.length,f=c/2;for(b=0;e>b;b+=4)d[b+0]+=f-2*f*Math.random(),d[b+1]+=f-2*f*Math.random(),d[b+2]+=f-2*f*Math.random()***REMOVED***,Kinetic.Factory.addGetterSetter(Kinetic.Node,"noise",.2,null,Kinetic.Factory.afterSetFilter)***REMOVED***(),function()***REMOVED***Kinetic.Filters.Pixelate=function(a)***REMOVED***var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p=Math.ceil(this.pixelSize()),q=a.width,r=a.height,s=Math.ceil(q/p),t=Math.ceil(r/p);for(a=a.data,m=0;s>m;m+=1)for(n=0;t>n;n+=1)***REMOVED***for(e=0,f=0,g=0,h=0,i=m*p,j=i+p,k=n*p,l=k+p,o=0,b=i;j>b;b+=1)if(!(b>=q))for(c=k;l>c;c+=1)c>=r||(d=4*(q*c+b),e+=a[d+0],f+=a[d+1],g+=a[d+2],h+=a[d+3],o+=1);for(e/=o,f/=o,g/=o,b=i;j>b;b+=1)if(!(b>=q))for(c=k;l>c;c+=1)c>=r||(d=4*(q*c+b),a[d+0]=e,a[d+1]=f,a[d+2]=g,a[d+3]=h)***REMOVED******REMOVED***,Kinetic.Factory.addGetterSetter(Kinetic.Node,"pixelSize",8,null,Kinetic.Factory.afterSetFilter)***REMOVED***(),function()***REMOVED***Kinetic.Filters.Threshold=function(a)***REMOVED***var b,c=255*this.threshold(),d=a.data,e=d.length;for(b=0;e>b;b+=1)d[b]=d[b]<c?0:255***REMOVED***,Kinetic.Factory.addGetterSetter(Kinetic.Node,"threshold",.5,null,Kinetic.Factory.afterSetFilter)***REMOVED***(),function()***REMOVED***Kinetic.Filters.Sepia=function(a)***REMOVED***var b,c,d,e,f,g,h,i,j,k=a.data,l=a.width,m=a.height,n=4*l;do***REMOVED***b=(m-1)*n,c=l;do d=b+4*(c-1),e=k[d],f=k[d+1],g=k[d+2],h=.393*e+.769*f+.189*g,i=.349*e+.686*f+.168*g,j=.272*e+.534*f+.131*g,k[d]=h>255?255:h,k[d+1]=i>255?255:i,k[d+2]=j>255?255:j,k[d+3]=k[d+3];while(--c)***REMOVED***while(--m)***REMOVED******REMOVED***(),function()***REMOVED***Kinetic.Filters.Solarize=function(a)***REMOVED***var b=a.data,c=a.width,d=a.height,e=4*c,f=d;do***REMOVED***var g=(f-1)*e,h=c;do***REMOVED***var i=g+4*(h-1),j=b[i],k=b[i+1],l=b[i+2];j>127&&(j=255-j),k>127&&(k=255-k),l>127&&(l=255-l),b[i]=j,b[i+1]=k,b[i+2]=l***REMOVED***while(--h)***REMOVED***while(--f)***REMOVED******REMOVED***(),function()***REMOVED***var a=function(a,b,c)***REMOVED***var d,e,f,g,h=a.data,i=b.data,j=a.width,k=a.height,l=c.polarCenterX||j/2,m=c.polarCenterY||k/2,n=0,o=0,p=0,q=0,r=Math.sqrt(l*l+m*m);e=j-l,f=k-m,g=Math.sqrt(e*e+f*f),r=g>r?g:r;var s,t,u,v,w=k,x=j,y=360/x*Math.PI/180;for(t=0;x>t;t+=1)for(u=Math.sin(t*y),v=Math.cos(t*y),s=0;w>s;s+=1)e=Math.floor(l+r*s/w*v),f=Math.floor(m+r*s/w*u),d=4*(f*j+e),n=h[d+0],o=h[d+1],p=h[d+2],q=h[d+3],d=4*(t+s*j),i[d+0]=n,i[d+1]=o,i[d+2]=p,i[d+3]=q***REMOVED***,b=function(a,b,c)***REMOVED***var d,e,f,g,h,i,j=a.data,k=b.data,l=a.width,m=a.height,n=c.polarCenterX||l/2,o=c.polarCenterY||m/2,p=0,q=0,r=0,s=0,t=Math.sqrt(n*n+o*o);e=l-n,f=m-o,i=Math.sqrt(e*e+f*f),t=i>t?i:t;var u,v,w,x,y=m,z=l,A=c.polarRotation||0;for(e=0;l>e;e+=1)for(f=0;m>f;f+=1)g=e-n,h=f-o,u=Math.sqrt(g*g+h*h)*y/t,v=(180*Math.atan2(h,g)/Math.PI+360+A)%360,v=v*z/360,w=Math.floor(v),x=Math.floor(u),d=4*(x*l+w),p=j[d+0],q=j[d+1],r=j[d+2],s=j[d+3],d=4*(f*l+e),k[d+0]=p,k[d+1]=q,k[d+2]=r,k[d+3]=s***REMOVED***,c=Kinetic.Util.createCanvasElement();Kinetic.Filters.Kaleidoscope=function(d)***REMOVED***var e,f,g,h,i,j,k,l,m,n,o=d.width,p=d.height,q=Math.round(this.kaleidoscopePower()),r=Math.round(this.kaleidoscopeAngle()),s=Math.floor(o*(r%360)/360);if(!(1>q))***REMOVED***c.width=o,c.height=p;var t=c.getContext("2d").getImageData(0,0,o,p);a(d,t,***REMOVED***polarCenterX:o/2,polarCenterY:p/2***REMOVED***);for(var u=o/Math.pow(2,q);8>=u;)u=2*u,q-=1;u=Math.ceil(u);var v=u,w=0,x=v,y=1;for(s+u>o&&(w=v,x=0,y=-1),f=0;p>f;f+=1)for(e=w;e!==x;e+=y)g=Math.round(e+s)%o,m=4*(o*f+g),i=t.data[m+0],j=t.data[m+1],k=t.data[m+2],l=t.data[m+3],n=4*(o*f+e),t.data[n+0]=i,t.data[n+1]=j,t.data[n+2]=k,t.data[n+3]=l;for(f=0;p>f;f+=1)for(v=Math.floor(u),h=0;q>h;h+=1)***REMOVED***for(e=0;v+1>e;e+=1)m=4*(o*f+e),i=t.data[m+0],j=t.data[m+1],k=t.data[m+2],l=t.data[m+3],n=4*(o*f+2*v-e-1),t.data[n+0]=i,t.data[n+1]=j,t.data[n+2]=k,t.data[n+3]=l;v*=2***REMOVED***b(t,d,***REMOVED***polarRotation:0***REMOVED***)***REMOVED******REMOVED***,Kinetic.Factory.addGetterSetter(Kinetic.Node,"kaleidoscopePower",2,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"kaleidoscopeAngle",0,null,Kinetic.Factory.afterSetFilter)***REMOVED***(),function()***REMOVED***function a(a)***REMOVED***Kinetic.root.setTimeout(a,1e3/60)***REMOVED***function b()***REMOVED***return e.apply(Kinetic.root,arguments)***REMOVED***var c=500,d=function()***REMOVED***return Kinetic.root.performance&&Kinetic.root.performance.now?function()***REMOVED***return Kinetic.root.performance.now()***REMOVED***:function()***REMOVED***return(new Date).getTime()***REMOVED******REMOVED***(),e=function()***REMOVED***return Kinetic.root.requestAnimationFrame||Kinetic.root.webkitRequestAnimationFrame||Kinetic.root.mozRequestAnimationFrame||Kinetic.root.oRequestAnimationFrame||Kinetic.root.msRequestAnimationFrame||a***REMOVED***();Kinetic.Animation=function(a,b)***REMOVED***var c=Kinetic.Animation;this.func=a,this.setLayers(b),this.id=c.animIdCounter++,this.frame=***REMOVED***time:0,timeDiff:0,lastTime:d()***REMOVED******REMOVED***,Kinetic.Animation.prototype=***REMOVED***setLayers:function(a)***REMOVED***var b=[];b=a?a.length>0?a:[a]:[],this.layers=b***REMOVED***,getLayers:function()***REMOVED***return this.layers***REMOVED***,addLayer:function(a)***REMOVED***var b,c,d=this.layers;if(d)***REMOVED***for(b=d.length,c=0;b>c;c++)if(d[c]._id===a._id)return!1***REMOVED***else this.layers=[];return this.layers.push(a),!0***REMOVED***,isRunning:function()***REMOVED***var a,b=Kinetic.Animation,c=b.animations,d=c.length;for(a=0;d>a;a++)if(c[a].id===this.id)return!0;return!1***REMOVED***,start:function()***REMOVED***var a=Kinetic.Animation;this.stop(),this.frame.timeDiff=0,this.frame.lastTime=d(),a._addAnimation(this)***REMOVED***,stop:function()***REMOVED***Kinetic.Animation._removeAnimation(this)***REMOVED***,_updateFrameObject:function(a)***REMOVED***this.frame.timeDiff=a-this.frame.lastTime,this.frame.lastTime=a,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff***REMOVED******REMOVED***,Kinetic.Animation.animations=[],Kinetic.Animation.animIdCounter=0,Kinetic.Animation.animRunning=!1,Kinetic.Animation._addAnimation=function(a)***REMOVED***this.animations.push(a),this._handleAnimation()***REMOVED***,Kinetic.Animation._removeAnimation=function(a)***REMOVED***var b,c=a.id,d=this.animations,e=d.length;for(b=0;e>b;b++)if(d[b].id===c)***REMOVED***this.animations.splice(b,1);break***REMOVED******REMOVED***,Kinetic.Animation._runFrames=function()***REMOVED***var a,b,c,e,f,g,h,i,j=***REMOVED******REMOVED***,k=this.animations;for(e=0;e<k.length;e++)***REMOVED***for(a=k[e],b=a.layers,c=a.func,a._updateFrameObject(d()),g=b.length,f=0;g>f;f++)h=b[f],void 0!==h._id&&(j[h._id]=h);c&&c.call(a,a.frame)***REMOVED***for(i in j)j[i].draw()***REMOVED***,Kinetic.Animation._animationLoop=function()***REMOVED***var a=Kinetic.Animation;a.animations.length?(b(a._animationLoop),a._runFrames()):a.animRunning=!1***REMOVED***,Kinetic.Animation._handleAnimation=function()***REMOVED***var a=this;this.animRunning||(this.animRunning=!0,a._animationLoop())***REMOVED***;var f=Kinetic.Node.prototype.moveTo;Kinetic.Node.prototype.moveTo=function(a)***REMOVED***f.call(this,a)***REMOVED***,Kinetic.Layer.prototype.batchDraw=function()***REMOVED***var a=this,b=Kinetic.Animation;this.batchAnim||(this.batchAnim=new b(function()***REMOVED***a.lastBatchDrawTime&&d()-a.lastBatchDrawTime>c&&a.batchAnim.stop()***REMOVED***,this)),this.lastBatchDrawTime=d(),this.batchAnim.isRunning()||(this.draw(),this.batchAnim.start())***REMOVED***,Kinetic.Stage.prototype.batchDraw=function()***REMOVED***this.getChildren().each(function(a)***REMOVED***a.batchDraw()***REMOVED***)***REMOVED******REMOVED***((1,eval)("this")),function()***REMOVED***var a=***REMOVED***node:1,duration:1,easing:1,onFinish:1,yoyo:1***REMOVED***,b=1,c=2,d=3,e=0;Kinetic.Tween=function(b)***REMOVED***var c,d=this,g=b.node,h=g._id,i=b.duration||1,j=b.easing||Kinetic.Easings.Linear,k=!!b.yoyo;this.node=g,this._id=e++,this.anim=new Kinetic.Animation(function()***REMOVED***d.tween.onEnterFrame()***REMOVED***,g.getLayer()),this.tween=new f(c,function(a)***REMOVED***d._tweenFunc(a)***REMOVED***,j,0,1,1e3*i,k),this._addListeners(),Kinetic.Tween.attrs[h]||(Kinetic.Tween.attrs[h]=***REMOVED******REMOVED***),Kinetic.Tween.attrs[h][this._id]||(Kinetic.Tween.attrs[h][this._id]=***REMOVED******REMOVED***),Kinetic.Tween.tweens[h]||(Kinetic.Tween.tweens[h]=***REMOVED******REMOVED***);for(c in b)void 0===a[c]&&this._addAttr(c,b[c]);this.reset(),this.onFinish=b.onFinish,this.onReset=b.onReset***REMOVED***,Kinetic.Tween.attrs=***REMOVED******REMOVED***,Kinetic.Tween.tweens=***REMOVED******REMOVED***,Kinetic.Tween.prototype=***REMOVED***_addAttr:function(a,b)***REMOVED***var c,d,e,f,g,h=this.node,i=h._id;if(e=Kinetic.Tween.tweens[i][a],e&&delete Kinetic.Tween.attrs[i][e][a],c=h.getAttr(a),Kinetic.Util._isArray(b))for(d=[],g=b.length,f=0;g>f;f++)d.push(b[f]-c[f]);else d=b-c;Kinetic.Tween.attrs[i][this._id][a]=***REMOVED***start:c,diff:d***REMOVED***,Kinetic.Tween.tweens[i][a]=this._id***REMOVED***,_tweenFunc:function(a)***REMOVED***var b,c,d,e,f,g,h,i=this.node,j=Kinetic.Tween.attrs[i._id][this._id];for(b in j)***REMOVED***if(c=j[b],d=c.start,e=c.diff,Kinetic.Util._isArray(d))for(f=[],h=d.length,g=0;h>g;g++)f.push(d[g]+e[g]*a);else f=d+e*a;i.setAttr(b,f)***REMOVED******REMOVED***,_addListeners:function()***REMOVED***var a=this;this.tween.onPlay=function()***REMOVED***a.anim.start()***REMOVED***,this.tween.onReverse=function()***REMOVED***a.anim.start()***REMOVED***,this.tween.onPause=function()***REMOVED***a.anim.stop()***REMOVED***,this.tween.onFinish=function()***REMOVED***a.onFinish&&a.onFinish()***REMOVED***,this.tween.onReset=function()***REMOVED***a.onReset&&a.onReset()***REMOVED******REMOVED***,play:function()***REMOVED***return this.tween.play(),this***REMOVED***,reverse:function()***REMOVED***return this.tween.reverse(),this***REMOVED***,reset:function()***REMOVED***this.node;return this.tween.reset(),this***REMOVED***,seek:function(a)***REMOVED***this.node;return this.tween.seek(1e3*a),this***REMOVED***,pause:function()***REMOVED***return this.tween.pause(),this***REMOVED***,finish:function()***REMOVED***this.node;return this.tween.finish(),this***REMOVED***,destroy:function()***REMOVED***var a,b=this.node._id,c=this._id,d=Kinetic.Tween.tweens[b];this.pause();for(a in d)delete Kinetic.Tween.tweens[b][a];delete Kinetic.Tween.attrs[b][c]***REMOVED******REMOVED***;var f=function(a,b,c,d,e,f,g)***REMOVED***this.prop=a,this.propFunc=b,this.begin=d,this._pos=d,this.duration=f,this._change=0,this.prevPos=0,this.yoyo=g,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=c,this._change=e-this.begin,this.pause()***REMOVED***;f.prototype=***REMOVED***fire:function(a)***REMOVED***var b=this[a];b&&b()***REMOVED***,setTime:function(a)***REMOVED***a>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():0>a?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=a,this.update())***REMOVED***,getTime:function()***REMOVED***return this._time***REMOVED***,setPosition:function(a)***REMOVED***this.prevPos=this._pos,this.propFunc(a),this._pos=a***REMOVED***,getPosition:function(a)***REMOVED***return void 0===a&&(a=this._time),this.func(a,this.begin,this._change,this.duration)***REMOVED***,play:function()***REMOVED***this.state=c,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")***REMOVED***,reverse:function()***REMOVED***this.state=d,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")***REMOVED***,seek:function(a)***REMOVED***this.pause(),this._time=a,this.update(),this.fire("onSeek")***REMOVED***,reset:function()***REMOVED***this.pause(),this._time=0,this.update(),this.fire("onReset")***REMOVED***,finish:function()***REMOVED***this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")***REMOVED***,update:function()***REMOVED***this.setPosition(this.getPosition(this._time))***REMOVED***,onEnterFrame:function()***REMOVED***var a=this.getTimer()-this._startTime;this.state===c?this.setTime(a):this.state===d&&this.setTime(this.duration-a)***REMOVED***,pause:function()***REMOVED***this.state=b,this.fire("onPause")***REMOVED***,getTimer:function()***REMOVED***return(new Date).getTime()***REMOVED******REMOVED***,Kinetic.Easings=***REMOVED***BackEaseIn:function(a,b,c,d)***REMOVED***var e=1.70158;return c*(a/=d)*a*((e+1)*a-e)+b***REMOVED***,BackEaseOut:function(a,b,c,d)***REMOVED***var e=1.70158;return c*((a=a/d-1)*a*((e+1)*a+e)+1)+b***REMOVED***,BackEaseInOut:function(a,b,c,d)***REMOVED***var e=1.70158;return(a/=d/2)<1?c/2*a*a*(((e*=1.525)+1)*a-e)+b:c/2*((a-=2)*a*(((e*=1.525)+1)*a+e)+2)+b***REMOVED***,ElasticEaseIn:function(a,b,c,d,e,f)***REMOVED***var g=0;return 0===a?b:1==(a/=d)?b+c:(f||(f=.3*d),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),-(e*Math.pow(2,10*(a-=1))*Math.sin(2*(a*d-g)*Math.PI/f))+b)***REMOVED***,ElasticEaseOut:function(a,b,c,d,e,f)***REMOVED***var g=0;return 0===a?b:1==(a/=d)?b+c:(f||(f=.3*d),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),e*Math.pow(2,-10*a)*Math.sin(2*(a*d-g)*Math.PI/f)+c+b)***REMOVED***,ElasticEaseInOut:function(a,b,c,d,e,f)***REMOVED***var g=0;return 0===a?b:2==(a/=d/2)?b+c:(f||(f=.3*d*1.5),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),1>a?-.5*e*Math.pow(2,10*(a-=1))*Math.sin(2*(a*d-g)*Math.PI/f)+b:e*Math.pow(2,-10*(a-=1))*Math.sin(2*(a*d-g)*Math.PI/f)*.5+c+b)***REMOVED***,BounceEaseOut:function(a,b,c,d)***REMOVED***return(a/=d)<1/2.75?7.5625*c*a*a+b:2/2.75>a?c*(7.5625*(a-=1.5/2.75)*a+.75)+b:2.5/2.75>a?c*(7.5625*(a-=2.25/2.75)*a+.9375)+b:c*(7.5625*(a-=2.625/2.75)*a+.984375)+b***REMOVED***,BounceEaseIn:function(a,b,c,d)***REMOVED***return c-Kinetic.Easings.BounceEaseOut(d-a,0,c,d)+b***REMOVED***,BounceEaseInOut:function(a,b,c,d)***REMOVED***return d/2>a?.5*Kinetic.Easings.BounceEaseIn(2*a,0,c,d)+b:.5*Kinetic.Easings.BounceEaseOut(2*a-d,0,c,d)+.5*c+b***REMOVED***,EaseIn:function(a,b,c,d)***REMOVED***return c*(a/=d)*a+b***REMOVED***,EaseOut:function(a,b,c,d)***REMOVED***return-c*(a/=d)*(a-2)+b***REMOVED***,EaseInOut:function(a,b,c,d)***REMOVED***return(a/=d/2)<1?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b***REMOVED***,StrongEaseIn:function(a,b,c,d)***REMOVED***return c*(a/=d)*a*a*a*a+b***REMOVED***,StrongEaseOut:function(a,b,c,d)***REMOVED***return c*((a=a/d-1)*a*a*a*a+1)+b***REMOVED***,StrongEaseInOut:function(a,b,c,d)***REMOVED***return(a/=d/2)<1?c/2*a*a*a*a*a+b:c/2*((a-=2)*a*a*a*a+2)+b***REMOVED***,Linear:function(a,b,c,d)***REMOVED***return c*a/d+b***REMOVED******REMOVED******REMOVED***(),function()***REMOVED***Kinetic.DD=***REMOVED***anim:new Kinetic.Animation,isDragging:!1,offset:***REMOVED***x:0,y:0***REMOVED***,node:null,_drag:function(a)***REMOVED***var b=Kinetic.DD,c=b.node;if(c)***REMOVED***if(!b.isDragging)***REMOVED***var d=c.getStage().getPointerPosition(),e=c.dragDistance(),f=Math.max(Math.abs(d.x-b.startPointerPos.x),Math.abs(d.y-b.startPointerPos.y));if(e>f)return***REMOVED***c._setDragPosition(a),b.isDragging||(b.isDragging=!0,c.fire("dragstart",a,!0)),c.fire("dragmove",a,!0)***REMOVED******REMOVED***,_endDragBefore:function(a)***REMOVED***var b,c,d=Kinetic.DD,e=d.node;e&&(b=e.nodeType,c=e.getLayer(),d.anim.stop(),d.isDragging&&(d.isDragging=!1,Kinetic.listenClickTap=!1,a&&(a.dragEndNode=e)),delete d.node,(c||e).draw())***REMOVED***,_endDragAfter:function(a)***REMOVED***a=a||***REMOVED******REMOVED***;var b=a.dragEndNode;a&&b&&b.fire("dragend",a,!0)***REMOVED******REMOVED***,Kinetic.Node.prototype.startDrag=function()***REMOVED***var a=Kinetic.DD,b=this.getStage(),c=this.getLayer(),d=b.getPointerPosition(),e=this.getAbsolutePosition();d&&(a.node&&a.node.stopDrag(),a.node=this,a.startPointerPos=d,a.offset.x=d.x-e.x,a.offset.y=d.y-e.y,a.anim.setLayers(c||this.getLayers()),a.anim.start(),this._setDragPosition())***REMOVED***,Kinetic.Node.prototype._setDragPosition=function(a)***REMOVED***var b=Kinetic.DD,c=this.getStage().getPointerPosition(),d=this.getDragBoundFunc();if(c)***REMOVED***var e=***REMOVED***x:c.x-b.offset.x,y:c.y-b.offset.y***REMOVED***;void 0!==d&&(e=d.call(this,e,a)),this.setAbsolutePosition(e)***REMOVED******REMOVED***,Kinetic.Node.prototype.stopDrag=function()***REMOVED***var a=Kinetic.DD,b=***REMOVED******REMOVED***;a._endDragBefore(b),a._endDragAfter(b)***REMOVED***,Kinetic.Node.prototype.setDraggable=function(a)***REMOVED***this._setAttr("draggable",a),this._dragChange()***REMOVED***;var a=Kinetic.Node.prototype.destroy;Kinetic.Node.prototype.destroy=function()***REMOVED***var b=Kinetic.DD;b.node&&b.node._id===this._id&&this.stopDrag(),a.call(this)***REMOVED***,Kinetic.Node.prototype.isDragging=function()***REMOVED***var a=Kinetic.DD;return a.node&&a.node._id===this._id&&a.isDragging***REMOVED***,Kinetic.Node.prototype._listenDrag=function()***REMOVED***var a=this;this._dragCleanup(),"Stage"===this.getClassName()?this.on("contentMousedown.kinetic contentTouchstart.kinetic",function(b)***REMOVED***Kinetic.DD.node||a.startDrag(b)***REMOVED***):this.on("mousedown.kinetic touchstart.kinetic",function(b)***REMOVED***Kinetic.DD.node||a.startDrag(b)***REMOVED***)***REMOVED***,Kinetic.Node.prototype._dragChange=function()***REMOVED***if(this.attrs.draggable)this._listenDrag();else***REMOVED***this._dragCleanup();var a=this.getStage(),b=Kinetic.DD;a&&b.node&&b.node._id===this._id&&b.node.stopDrag()***REMOVED******REMOVED***,Kinetic.Node.prototype._dragCleanup=function()***REMOVED***"Stage"===this.getClassName()?(this.off("contentMousedown.kinetic"),this.off("contentTouchstart.kinetic")):(this.off("mousedown.kinetic"),this.off("touchstart.kinetic"))***REMOVED***,Kinetic.Factory.addGetterSetter(Kinetic.Node,"dragBoundFunc"),Kinetic.Factory.addGetter(Kinetic.Node,"draggable",!1),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"draggable");var b=Kinetic.document.documentElement;b.addEventListener("mouseup",Kinetic.DD._endDragBefore,!0),b.addEventListener("touchend",Kinetic.DD._endDragBefore,!0),b.addEventListener("mouseup",Kinetic.DD._endDragAfter,!1),b.addEventListener("touchend",Kinetic.DD._endDragAfter,!1)***REMOVED***(),function()***REMOVED***Kinetic.Util.addMethods(Kinetic.Container,***REMOVED***__init:function(a)***REMOVED***this.children=new Kinetic.Collection,Kinetic.Node.call(this,a)***REMOVED***,getChildren:function(a)***REMOVED***if(a)***REMOVED***var b=new Kinetic.Collection;return this.children.each(function(c)***REMOVED***a(c)&&b.push(c)***REMOVED***),b***REMOVED***return this.children***REMOVED***,hasChildren:function()***REMOVED***return this.getChildren().length>0***REMOVED***,removeChildren:function()***REMOVED***for(var a,b=Kinetic.Collection.toCollection(this.children),c=0;c<b.length;c++)a=b[c],delete a.parent,a.index=0,a.hasChildren()&&a.removeChildren(),a.remove();return b=null,this.children=new Kinetic.Collection,this***REMOVED***,destroyChildren:function()***REMOVED***for(var a,b=Kinetic.Collection.toCollection(this.children),c=0;c<b.length;c++)a=b[c],delete a.parent,a.index=0,a.destroy();return b=null,this.children=new Kinetic.Collection,this***REMOVED***,add:function(a)***REMOVED***if(!(arguments.length>1))***REMOVED***if(a.getParent())return void a.moveTo(this);var b=this.children;return this._validateAdd(a),a.index=b.length,a.parent=this,b.push(a),this._fire("add",***REMOVED***child:a***REMOVED***),this***REMOVED***for(var c=0;c<arguments.length;c++)this.add(arguments[c])***REMOVED***,destroy:function()***REMOVED***this.hasChildren()&&this.destroyChildren(),Kinetic.Node.prototype.destroy.call(this)***REMOVED***,find:function(a)***REMOVED***var b,c,d,e,f,g,h,i=[],j=a.replace(/ /g,"").split(","),k=j.length;for(b=0;k>b;b++)if(d=j[b],"#"===d.charAt(0))f=this._getNodeById(d.slice(1)),f&&i.push(f);else if("."===d.charAt(0))e=this._getNodesByName(d.slice(1)),i=i.concat(e);else for(g=this.getChildren(),h=g.length,c=0;h>c;c++)i=i.concat(g[c]._get(d));return Kinetic.Collection.toCollection(i)***REMOVED***,_getNodeById:function(a)***REMOVED***var b=Kinetic.ids[a];return void 0!==b&&this.isAncestorOf(b)?b:null***REMOVED***,_getNodesByName:function(a)***REMOVED***var b=Kinetic.names[a]||[];return this._getDescendants(b)***REMOVED***,_get:function(a)***REMOVED***for(var b=Kinetic.Node.prototype._get.call(this,a),c=this.getChildren(),d=c.length,e=0;d>e;e++)b=b.concat(c[e]._get(a));return b***REMOVED***,toObject:function()***REMOVED***var a=Kinetic.Node.prototype.toObject.call(this);a.children=[];for(var b=this.getChildren(),c=b.length,d=0;c>d;d++)***REMOVED***var e=b[d];a.children.push(e.toObject())***REMOVED***return a***REMOVED***,_getDescendants:function(a)***REMOVED***for(var b=[],c=a.length,d=0;c>d;d++)***REMOVED***var e=a[d];this.isAncestorOf(e)&&b.push(e)***REMOVED***return b***REMOVED***,isAncestorOf:function(a)***REMOVED***for(var b=a.getParent();b;)***REMOVED***if(b._id===this._id)return!0;b=b.getParent()***REMOVED***return!1***REMOVED***,clone:function(a)***REMOVED***var b=Kinetic.Node.prototype.clone.call(this,a);return this.getChildren().each(function(a)***REMOVED***b.add(a.clone())***REMOVED***),b***REMOVED***,getAllIntersections:function(a)***REMOVED***var b=[];return this.find("Shape").each(function(c)***REMOVED***c.isVisible()&&c.intersects(a)&&b.push(c)***REMOVED***),b***REMOVED***,_setChildrenIndices:function()***REMOVED***this.children.each(function(a,b)***REMOVED***a.index=b***REMOVED***)***REMOVED***,drawScene:function(a,b)***REMOVED***var c=this.getLayer(),d=a||c&&c.getCanvas(),e=d&&d.getContext(),f=this._cache.canvas,g=f&&f.scene;return this.isVisible()&&(g?this._drawCachedSceneCanvas(e):this._drawChildren(d,"drawScene",b)),this***REMOVED***,drawHit:function(a,b)***REMOVED***var c=this.getLayer(),d=a||c&&c.hitCanvas,e=d&&d.getContext(),f=this._cache.canvas,g=f&&f.hit;return this.shouldDrawHit()&&(g?this._drawCachedHitCanvas(e):this._drawChildren(d,"drawHit",b)),this***REMOVED***,_drawChildren:function(a,b,c)***REMOVED***var d,e,f=this.getLayer(),g=a&&a.getContext(),h=this.getClipWidth(),i=this.getClipHeight(),j=h&&i;
j&&f&&(d=this.getClipX(),e=this.getClipY(),g.save(),f._applyTransform(this,g),g.beginPath(),g.rect(d,e,h,i),g.clip(),g.reset()),this.children.each(function(d)***REMOVED***d[b](a,c)***REMOVED***),j&&g.restore()***REMOVED******REMOVED***),Kinetic.Util.extend(Kinetic.Container,Kinetic.Node),Kinetic.Container.prototype.get=Kinetic.Container.prototype.find,Kinetic.Factory.addComponentsGetterSetter(Kinetic.Container,"clip",["x","y","width","height"]),Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipX"),Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipY"),Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipWidth"),Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipHeight"),Kinetic.Collection.mapMethods(Kinetic.Container)***REMOVED***(),function()***REMOVED***function a(a)***REMOVED***a.fill()***REMOVED***function b(a)***REMOVED***a.stroke()***REMOVED***function c(a)***REMOVED***a.fill()***REMOVED***function d(a)***REMOVED***a.stroke()***REMOVED***function e()***REMOVED***this._clearCache(f)***REMOVED***var f="hasShadow";Kinetic.Util.addMethods(Kinetic.Shape,***REMOVED***__init:function(f)***REMOVED***this.nodeType="Shape",this._fillFunc=a,this._strokeFunc=b,this._fillFuncHit=c,this._strokeFuncHit=d;for(var g,h=Kinetic.shapes;;)if(g=Kinetic.Util.getRandomColor(),g&&!(g in h))break;this.colorKey=g,h[g]=this,Kinetic.Node.call(this,f),this.on("shadowColorChange.kinetic shadowBlurChange.kinetic shadowOffsetChange.kinetic shadowOpacityChange.kinetic shadowEnabledChange.kinetic",e)***REMOVED***,hasChildren:function()***REMOVED***return!1***REMOVED***,getChildren:function()***REMOVED***return[]***REMOVED***,getContext:function()***REMOVED***return this.getLayer().getContext()***REMOVED***,getCanvas:function()***REMOVED***return this.getLayer().getCanvas()***REMOVED***,hasShadow:function()***REMOVED***return this._getCache(f,this._hasShadow)***REMOVED***,_hasShadow:function()***REMOVED***return this.getShadowEnabled()&&0!==this.getShadowOpacity()&&!!(this.getShadowColor()||this.getShadowBlur()||this.getShadowOffsetX()||this.getShadowOffsetY())***REMOVED***,hasFill:function()***REMOVED***return!!(this.getFill()||this.getFillPatternImage()||this.getFillLinearGradientColorStops()||this.getFillRadialGradientColorStops())***REMOVED***,hasStroke:function()***REMOVED***return!!(this.stroke()||this.strokeRed()||this.strokeGreen()||this.strokeBlue())***REMOVED***,_get:function(a)***REMOVED***return this.className===a||this.nodeType===a?[this]:[]***REMOVED***,intersects:function(a)***REMOVED***var b,c=this.getStage(),d=c.bufferHitCanvas;return d.getContext().clear(),this.drawScene(d),b=d.context.getImageData(Math.round(a.x),Math.round(a.y),1,1).data,b[3]>0***REMOVED***,destroy:function()***REMOVED***Kinetic.Node.prototype.destroy.call(this),delete Kinetic.shapes[this.colorKey]***REMOVED***,_useBufferCanvas:function()***REMOVED***return(this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasFill()&&this.hasStroke()&&this.getStage()***REMOVED***,drawScene:function(a,b)***REMOVED***var c,d,e,f=this.getLayer(),g=a||f.getCanvas(),h=g.getContext(),i=this._cache.canvas,j=this.sceneFunc(),k=this.hasShadow();return this.isVisible()&&(i?this._drawCachedSceneCanvas(h):j&&(h.save(),this._useBufferCanvas()?(c=this.getStage(),d=c.bufferCanvas,e=d.getContext(),e.clear(),e.save(),e._applyLineJoin(this),f._applyTransform(this,e,b),j.call(this,e),e.restore(),k&&(h.save(),h._applyShadow(this),h.drawImage(d._canvas,0,0),h.restore()),h._applyOpacity(this),h.drawImage(d._canvas,0,0)):(h._applyLineJoin(this),f._applyTransform(this,h,b),k&&(h.save(),h._applyShadow(this),j.call(this,h),h.restore()),h._applyOpacity(this),j.call(this,h)),h.restore())),this***REMOVED***,drawHit:function(a,b)***REMOVED***var c=this.getLayer(),d=a||c.hitCanvas,e=d.getContext(),f=this.hitFunc()||this.sceneFunc(),g=this._cache.canvas,h=g&&g.hit;return this.shouldDrawHit()&&(h?this._drawCachedHitCanvas(e):f&&(e.save(),e._applyLineJoin(this),c._applyTransform(this,e,b),f.call(this,e),e.restore())),this***REMOVED***,drawHitFromCache:function(a)***REMOVED***var b,c,d,e,f,g,h,i,j=a||0,k=this._cache.canvas,l=this._getCachedSceneCanvas(),m=l.getContext(),n=k.hit,o=n.getContext(),p=l.getWidth(),q=l.getHeight();o.clear();try***REMOVED***for(b=m.getImageData(0,0,p,q),c=b.data,d=o.getImageData(0,0,p,q),e=d.data,f=c.length,g=Kinetic.Util._hexToRgb(this.colorKey),h=0;f>h;h+=4)i=c[h+3],i>j&&(e[h]=g.r,e[h+1]=g.g,e[h+2]=g.b,e[h+3]=255);o.putImageData(d,0,0)***REMOVED***catch(r)***REMOVED***Kinetic.Util.warn("Unable to draw hit graph from cached scene canvas. "+r.message)***REMOVED***return this***REMOVED******REMOVED***),Kinetic.Util.extend(Kinetic.Shape,Kinetic.Node),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"stroke"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeRed",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeGreen",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeBlue",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeAlpha",1,Kinetic.Validators.alphaComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeWidth",2),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"lineJoin"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"lineCap"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"sceneFunc"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"hitFunc"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"dash"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowColor"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowRed",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowGreen",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowBlue",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowAlpha",1,Kinetic.Validators.alphaComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowBlur"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowOpacity"),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"shadowOffset",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowOffsetX",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowOffsetY",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternImage"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fill"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRed",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillGreen",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillBlue",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillAlpha",1,Kinetic.Validators.alphaComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternX",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternY",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientColorStops"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientStartRadius",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientEndRadius",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientColorStops"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternRepeat","repeat"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"dashEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeScaleEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPriority","color"),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillPatternOffset",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternOffsetX",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternOffsetY",0),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillPatternScale",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternScaleX",1),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternScaleY",1),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillLinearGradientStartPoint",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientStartPointX",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientStartPointY",0),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillLinearGradientEndPoint",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientEndPointX",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientEndPointY",0),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillRadialGradientStartPoint",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientStartPointX",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientStartPointY",0),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillRadialGradientEndPoint",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientEndPointX",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientEndPointY",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternRotation",0),Kinetic.Factory.backCompat(Kinetic.Shape,***REMOVED***dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"***REMOVED***),Kinetic.Collection.mapMethods(Kinetic.Shape)***REMOVED***(),function()***REMOVED***function a(a,b)***REMOVED***a.content.addEventListener(b,function(c)***REMOVED***a[I+b](c)***REMOVED***,!1)***REMOVED***var b="Stage",c="string",d="px",e="mouseout",f="mouseleave",g="mouseover",h="mouseenter",i="mousemove",j="mousedown",k="mouseup",l="click",m="dblclick",n="touchstart",o="touchend",p="tap",q="dbltap",r="touchmove",s="contentMouseout",t="contentMouseover",u="contentMousemove",v="contentMousedown",w="contentMouseup",x="contentClick",y="contentDblclick",z="contentTouchstart",A="contentTouchend",B="contentDbltap",C="contentTouchmove",D="div",E="relative",F="inline-block",G="kineticjs-content",H=" ",I="_",J="container",K="",L=[j,i,k,e,n,r,o,g],M=L.length;Kinetic.Util.addMethods(Kinetic.Stage,***REMOVED***___init:function(a)***REMOVED***this.nodeType=b,Kinetic.Container.call(this,a),this._id=Kinetic.idCounter++,this._buildDOM(),this._bindContentEvents(),this._enableNestedTransforms=!1,Kinetic.stages.push(this)***REMOVED***,_validateAdd:function(a)***REMOVED***"Layer"!==a.getType()&&Kinetic.Util.error("You may only add layers to the stage.")***REMOVED***,setContainer:function(a)***REMOVED***if(typeof a===c)***REMOVED***var b=a;if(a=Kinetic.document.getElementById(a),!a)throw"Can not find container in document with id "+b***REMOVED***return this._setAttr(J,a),this***REMOVED***,shouldDrawHit:function()***REMOVED***return!0***REMOVED***,draw:function()***REMOVED***return Kinetic.Node.prototype.draw.call(this),this***REMOVED***,setHeight:function(a)***REMOVED***return Kinetic.Node.prototype.setHeight.call(this,a),this._resizeDOM(),this***REMOVED***,setWidth:function(a)***REMOVED***return Kinetic.Node.prototype.setWidth.call(this,a),this._resizeDOM(),this***REMOVED***,clear:function()***REMOVED***var a,b=this.children,c=b.length;for(a=0;c>a;a++)b[a].clear();return this***REMOVED***,clone:function(a)***REMOVED***return a||(a=***REMOVED******REMOVED***),a.container=Kinetic.document.createElement(D),Kinetic.Container.prototype.clone.call(this,a)***REMOVED***,destroy:function()***REMOVED***var a=this.content;Kinetic.Container.prototype.destroy.call(this),a&&Kinetic.Util._isInDocument(a)&&this.getContainer().removeChild(a);var b=Kinetic.stages.indexOf(this);b>-1&&Kinetic.stages.splice(b,1)***REMOVED***,getPointerPosition:function()***REMOVED***return this.pointerPos***REMOVED***,getStage:function()***REMOVED***return this***REMOVED***,getContent:function()***REMOVED***return this.content***REMOVED***,toDataURL:function(a)***REMOVED***function b(e)***REMOVED***var f=i[e],j=f.toDataURL(),k=new Kinetic.window.Image;k.onload=function()***REMOVED***h.drawImage(k,0,0),e<i.length-1?b(e+1):a.callback(g.toDataURL(c,d))***REMOVED***,k.src=j***REMOVED***a=a||***REMOVED******REMOVED***;var c=a.mimeType||null,d=a.quality||null,e=a.x||0,f=a.y||0,g=new Kinetic.SceneCanvas(***REMOVED***width:a.width||this.getWidth(),height:a.height||this.getHeight(),pixelRatio:1***REMOVED***),h=g.getContext()._context,i=this.children;(e||f)&&h.translate(-1*e,-1*f),b(0)***REMOVED***,toImage:function(a)***REMOVED***var b=a.callback;a.callback=function(a)***REMOVED***Kinetic.Util._getImage(a,function(a)***REMOVED***b(a)***REMOVED***)***REMOVED***,this.toDataURL(a)***REMOVED***,getIntersection:function(a)***REMOVED***var b,c,d=this.getChildren(),e=d.length,f=e-1;for(b=f;b>=0;b--)if(c=d[b].getIntersection(a))return c;return null***REMOVED***,_resizeDOM:function()***REMOVED***if(this.content)***REMOVED***var a,b,c=this.getWidth(),e=this.getHeight(),f=this.getChildren(),g=f.length;for(this.content.style.width=c+d,this.content.style.height=e+d,this.bufferCanvas.setSize(c,e),this.bufferHitCanvas.setSize(c,e),a=0;g>a;a++)b=f[a],b.getCanvas().setSize(c,e),b.hitCanvas.setSize(c,e),b.draw()***REMOVED******REMOVED***,add:function(a)***REMOVED***if(!(arguments.length>1))return Kinetic.Container.prototype.add.call(this,a),a._setCanvasSize(this.width(),this.height()),a.draw(),this.content.appendChild(a.canvas._canvas),this;for(var b=0;b<arguments.length;b++)this.add(arguments[b])***REMOVED***,getParent:function()***REMOVED***return null***REMOVED***,getLayer:function()***REMOVED***return null***REMOVED***,getLayers:function()***REMOVED***return this.getChildren()***REMOVED***,_bindContentEvents:function()***REMOVED***for(var b=0;M>b;b++)a(this,L[b])***REMOVED***,_mouseover:function(a)***REMOVED***Kinetic.UA.mobile||(this._setPointerPosition(a),this._fire(t,***REMOVED***evt:a***REMOVED***))***REMOVED***,_mouseout:function(a)***REMOVED***if(!Kinetic.UA.mobile)***REMOVED***this._setPointerPosition(a);var b=this.targetShape;b&&!Kinetic.isDragging()&&(b._fireAndBubble(e,***REMOVED***evt:a***REMOVED***),b._fireAndBubble(f,***REMOVED***evt:a***REMOVED***),this.targetShape=null),this.pointerPos=void 0,this._fire(s,***REMOVED***evt:a***REMOVED***)***REMOVED******REMOVED***,_mousemove:function(a)***REMOVED***if(!Kinetic.UA.mobile)***REMOVED***this._setPointerPosition(a);var b=Kinetic.DD,c=this.getIntersection(this.getPointerPosition());c&&c.isListening()?Kinetic.isDragging()||this.targetShape&&this.targetShape._id===c._id?c._fireAndBubble(i,***REMOVED***evt:a***REMOVED***):(this.targetShape&&(this.targetShape._fireAndBubble(e,***REMOVED***evt:a***REMOVED***,c),this.targetShape._fireAndBubble(f,***REMOVED***evt:a***REMOVED***,c)),c._fireAndBubble(g,***REMOVED***evt:a***REMOVED***,this.targetShape),c._fireAndBubble(h,***REMOVED***evt:a***REMOVED***,this.targetShape),this.targetShape=c):this.targetShape&&!Kinetic.isDragging()&&(this.targetShape._fireAndBubble(e,***REMOVED***evt:a***REMOVED***),this.targetShape._fireAndBubble(f,***REMOVED***evt:a***REMOVED***),this.targetShape=null),this._fire(u,***REMOVED***evt:a***REMOVED***),b&&b._drag(a)***REMOVED***a.preventDefault&&a.preventDefault()***REMOVED***,_mousedown:function(a)***REMOVED***if(!Kinetic.UA.mobile)***REMOVED***this._setPointerPosition(a);var b=this.getIntersection(this.getPointerPosition());Kinetic.listenClickTap=!0,b&&b.isListening()&&(this.clickStartShape=b,b._fireAndBubble(j,***REMOVED***evt:a***REMOVED***)),this._fire(v,***REMOVED***evt:a***REMOVED***)***REMOVED***a.preventDefault&&a.preventDefault()***REMOVED***,_mouseup:function(a)***REMOVED***if(!Kinetic.UA.mobile)***REMOVED***this._setPointerPosition(a);var b=this.getIntersection(this.getPointerPosition()),c=this.clickStartShape,d=!1;Kinetic.inDblClickWindow?(d=!0,Kinetic.inDblClickWindow=!1):Kinetic.inDblClickWindow=!0,setTimeout(function()***REMOVED***Kinetic.inDblClickWindow=!1***REMOVED***,Kinetic.dblClickWindow),b&&b.isListening()&&(b._fireAndBubble(k,***REMOVED***evt:a***REMOVED***),Kinetic.listenClickTap&&c&&c._id===b._id&&(b._fireAndBubble(l,***REMOVED***evt:a***REMOVED***),d&&b._fireAndBubble(m,***REMOVED***evt:a***REMOVED***))),this._fire(w,***REMOVED***evt:a***REMOVED***),Kinetic.listenClickTap&&(this._fire(x,***REMOVED***evt:a***REMOVED***),d&&this._fire(y,***REMOVED***evt:a***REMOVED***)),Kinetic.listenClickTap=!1***REMOVED***a.preventDefault&&a.preventDefault()***REMOVED***,_touchstart:function(a)***REMOVED***this._setPointerPosition(a);var b=this.getIntersection(this.getPointerPosition());Kinetic.listenClickTap=!0,b&&b.isListening()&&(this.tapStartShape=b,b._fireAndBubble(n,***REMOVED***evt:a***REMOVED***),b.isListening()&&a.preventDefault&&a.preventDefault()),this._fire(z,***REMOVED***evt:a***REMOVED***)***REMOVED***,_touchend:function(a)***REMOVED***this._setPointerPosition(a);var b=this.getIntersection(this.getPointerPosition()),c=!1;Kinetic.inDblClickWindow?(c=!0,Kinetic.inDblClickWindow=!1):Kinetic.inDblClickWindow=!0,setTimeout(function()***REMOVED***Kinetic.inDblClickWindow=!1***REMOVED***,Kinetic.dblClickWindow),b&&b.isListening()&&(b._fireAndBubble(o,***REMOVED***evt:a***REMOVED***),Kinetic.listenClickTap&&b._id===this.tapStartShape._id&&(b._fireAndBubble(p,***REMOVED***evt:a***REMOVED***),c&&b._fireAndBubble(q,***REMOVED***evt:a***REMOVED***)),b.isListening()&&a.preventDefault&&a.preventDefault()),Kinetic.listenClickTap&&(this._fire(A,***REMOVED***evt:a***REMOVED***),c&&this._fire(B,***REMOVED***evt:a***REMOVED***)),Kinetic.listenClickTap=!1***REMOVED***,_touchmove:function(a)***REMOVED***this._setPointerPosition(a);var b=Kinetic.DD,c=this.getIntersection(this.getPointerPosition());c&&c.isListening()&&(c._fireAndBubble(r,***REMOVED***evt:a***REMOVED***),c.isListening()&&a.preventDefault&&a.preventDefault()),this._fire(C,***REMOVED***evt:a***REMOVED***),b&&b._drag(a)***REMOVED***,_setPointerPosition:function(a)***REMOVED***var b,c=this._getContentPosition(),d=a.offsetX,e=a.clientX,f=null,g=null;a=a?a:window.event,void 0!==a.touches?1===a.touches.length&&(b=a.touches[0],f=b.clientX-c.left,g=b.clientY-c.top):void 0!==d?(f=d,g=a.offsetY):"mozilla"===Kinetic.UA.browser?(f=a.layerX,g=a.layerY):void 0!==e&&c&&(f=e-c.left,g=a.clientY-c.top),null!==f&&null!==g&&(this.pointerPos=***REMOVED***x:f,y:g***REMOVED***)***REMOVED***,_getContentPosition:function()***REMOVED***var a=this.content.getBoundingClientRect?this.content.getBoundingClientRect():***REMOVED***top:0,left:0***REMOVED***;return***REMOVED***top:a.top,left:a.left***REMOVED******REMOVED***,_buildDOM:function()***REMOVED***var a=this.getContainer();if(!a)***REMOVED***if(Kinetic.Util.isBrowser())throw"Stage has not container. But container is required";a=Kinetic.document.createElement(D)***REMOVED***a.innerHTML=K,this.content=Kinetic.document.createElement(D),this.content.style.position=E,this.content.style.display=F,this.content.className=G,this.content.setAttribute("role","presentation"),a.appendChild(this.content),this.bufferCanvas=new Kinetic.SceneCanvas(***REMOVED***pixelRatio:1***REMOVED***),this.bufferHitCanvas=new Kinetic.HitCanvas,this._resizeDOM()***REMOVED***,_onContent:function(a,b)***REMOVED***var c,d,e=a.split(H),f=e.length;for(c=0;f>c;c++)d=e[c],this.content.addEventListener(d,b,!1)***REMOVED***,cache:function()***REMOVED***Kinetic.Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes.")***REMOVED***,clearCache:function()***REMOVED******REMOVED******REMOVED***),Kinetic.Util.extend(Kinetic.Stage,Kinetic.Container),Kinetic.Factory.addGetter(Kinetic.Stage,"container"),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Stage,"container")***REMOVED***(),function()***REMOVED***Kinetic.Util.addMethods(Kinetic.BaseLayer,***REMOVED***___init:function(a)***REMOVED***this.nodeType="Layer",Kinetic.Container.call(this,a)***REMOVED***,createPNGStream:function()***REMOVED***return this.canvas._canvas.createPNGStream()***REMOVED***,getCanvas:function()***REMOVED***return this.canvas***REMOVED***,getHitCanvas:function()***REMOVED***return this.hitCanvas***REMOVED***,getContext:function()***REMOVED***return this.getCanvas().getContext()***REMOVED***,clear:function(a)***REMOVED***return this.getContext().clear(a),this.getHitCanvas().getContext().clear(a),this***REMOVED***,setZIndex:function(a)***REMOVED***Kinetic.Node.prototype.setZIndex.call(this,a);var b=this.getStage();return b&&(b.content.removeChild(this.getCanvas()._canvas),a<b.getChildren().length-1?b.content.insertBefore(this.getCanvas()._canvas,b.getChildren()[a+1].getCanvas()._canvas):b.content.appendChild(this.getCanvas()._canvas)),this***REMOVED***,moveToTop:function()***REMOVED***Kinetic.Node.prototype.moveToTop.call(this);var a=this.getStage();a&&(a.content.removeChild(this.getCanvas()._canvas),a.content.appendChild(this.getCanvas()._canvas))***REMOVED***,moveUp:function()***REMOVED***if(Kinetic.Node.prototype.moveUp.call(this))***REMOVED***var a=this.getStage();a&&(a.content.removeChild(this.getCanvas()._canvas),this.index<a.getChildren().length-1?a.content.insertBefore(this.getCanvas()._canvas,a.getChildren()[this.index+1].getCanvas()._canvas):a.content.appendChild(this.getCanvas()._canvas))***REMOVED******REMOVED***,moveDown:function()***REMOVED***if(Kinetic.Node.prototype.moveDown.call(this))***REMOVED***var a=this.getStage();if(a)***REMOVED***var b=a.getChildren();a.content.removeChild(this.getCanvas()._canvas),a.content.insertBefore(this.getCanvas()._canvas,b[this.index+1].getCanvas()._canvas)***REMOVED******REMOVED******REMOVED***,moveToBottom:function()***REMOVED***if(Kinetic.Node.prototype.moveToBottom.call(this))***REMOVED***var a=this.getStage();if(a)***REMOVED***var b=a.getChildren();a.content.removeChild(this.getCanvas()._canvas),a.content.insertBefore(this.getCanvas()._canvas,b[1].getCanvas()._canvas)***REMOVED******REMOVED******REMOVED***,getLayer:function()***REMOVED***return this***REMOVED***,remove:function()***REMOVED***var a=this.getStage(),b=this.getCanvas(),c=b._canvas;return Kinetic.Node.prototype.remove.call(this),a&&c&&Kinetic.Util._isInDocument(c)&&a.content.removeChild(c),this***REMOVED***,getStage:function()***REMOVED***return this.parent***REMOVED******REMOVED***),Kinetic.Util.extend(Kinetic.BaseLayer,Kinetic.Container),Kinetic.Factory.addGetterSetter(Kinetic.BaseLayer,"clearBeforeDraw",!0),Kinetic.Collection.mapMethods(Kinetic.BaseLayer)***REMOVED***(),function()***REMOVED***var a="#",b="beforeDraw",c="draw",d=[***REMOVED***x:0,y:0***REMOVED***,***REMOVED***x:-1,y:0***REMOVED***,***REMOVED***x:-1,y:-1***REMOVED***,***REMOVED***x:0,y:-1***REMOVED***,***REMOVED***x:1,y:-1***REMOVED***,***REMOVED***x:1,y:0***REMOVED***,***REMOVED***x:1,y:1***REMOVED***,***REMOVED***x:0,y:1***REMOVED***,***REMOVED***x:-1,y:1***REMOVED***],e=d.length;Kinetic.Util.addMethods(Kinetic.Layer,***REMOVED***____init:function(a)***REMOVED***this.nodeType="Layer",this.canvas=new Kinetic.SceneCanvas,this.hitCanvas=new Kinetic.HitCanvas,Kinetic.BaseLayer.call(this,a)***REMOVED***,_setCanvasSize:function(a,b)***REMOVED***this.canvas.setSize(a,b),this.hitCanvas.setSize(a,b)***REMOVED***,_validateAdd:function(a)***REMOVED***var b=a.getType();"Group"!==b&&"Shape"!==b&&Kinetic.Util.error("You may only add groups and shapes to a layer.")***REMOVED***,getIntersection:function(a)***REMOVED***var b,c,f,g;if(!this.hitGraphEnabled()||!this.isVisible())return null;for(c=0;e>c;c++)***REMOVED***if(f=d[c],b=this._getIntersection(***REMOVED***x:a.x+f.x,y:a.y+f.y***REMOVED***),g=b.shape)return g;if(!b.antialiased)return null***REMOVED******REMOVED***,_getIntersection:function(b)***REMOVED***var c,d,e=this.hitCanvas.context._context.getImageData(b.x,b.y,1,1).data,f=e[3];return 255===f?(c=Kinetic.Util._rgbToHex(e[0],e[1],e[2]),d=Kinetic.shapes[a+c],***REMOVED***shape:d***REMOVED***):f>0?***REMOVED***antialiased:!0***REMOVED***:***REMOVED******REMOVED******REMOVED***,drawScene:function(a,d)***REMOVED***var e=this.getLayer(),f=a||e&&e.getCanvas();return this._fire(b,***REMOVED***node:this***REMOVED***),this.getClearBeforeDraw()&&f.getContext().clear(),Kinetic.Container.prototype.drawScene.call(this,f,d),this._fire(c,***REMOVED***node:this***REMOVED***),this***REMOVED***,_applyTransform:function(a,b,c)***REMOVED***var d=a.getAbsoluteTransform(c).getMatrix();b.transform(d[0],d[1],d[2],d[3],d[4],d[5])***REMOVED***,drawHit:function(a,b)***REMOVED***var c=this.getLayer(),d=a||c&&c.hitCanvas;return c&&c.getClearBeforeDraw()&&c.getHitCanvas().getContext().clear(),Kinetic.Container.prototype.drawHit.call(this,d,b),this***REMOVED***,clear:function(a)***REMOVED***return this.getContext().clear(a),this.getHitCanvas().getContext().clear(a),this***REMOVED***,setVisible:function(a)***REMOVED***return Kinetic.Node.prototype.setVisible.call(this,a),a?(this.getCanvas()._canvas.style.display="block",this.hitCanvas._canvas.style.display="block"):(this.getCanvas()._canvas.style.display="none",this.hitCanvas._canvas.style.display="none"),this***REMOVED***,enableHitGraph:function()***REMOVED***return this.setHitGraphEnabled(!0),this***REMOVED***,disableHitGraph:function()***REMOVED***return this.setHitGraphEnabled(!1),this***REMOVED******REMOVED***),Kinetic.Util.extend(Kinetic.Layer,Kinetic.BaseLayer),Kinetic.Factory.addGetterSetter(Kinetic.Layer,"hitGraphEnabled",!0),Kinetic.Collection.mapMethods(Kinetic.Layer)***REMOVED***(),function()***REMOVED***Kinetic.Util.addMethods(Kinetic.FastLayer,***REMOVED***____init:function(a)***REMOVED***this.nodeType="Layer",this.canvas=new Kinetic.SceneCanvas,Kinetic.BaseLayer.call(this,a)***REMOVED***,_validateAdd:function(a)***REMOVED***var b=a.getType();"Shape"!==b&&Kinetic.Util.error("You may only add shapes to a fast layer.")***REMOVED***,_setCanvasSize:function(a,b)***REMOVED***this.canvas.setSize(a,b)***REMOVED***,hitGraphEnabled:function()***REMOVED***return!1***REMOVED***,getIntersection:function()***REMOVED***return null***REMOVED***,drawScene:function(a)***REMOVED***var b=this.getLayer(),c=a||b&&b.getCanvas();return this.getClearBeforeDraw()&&c.getContext().clear(),Kinetic.Container.prototype.drawScene.call(this,c),this***REMOVED***,_applyTransform:function(a,b,c)***REMOVED***if(!c||c._id!==this._id)***REMOVED***var d=a.getTransform().getMatrix();b.transform(d[0],d[1],d[2],d[3],d[4],d[5])***REMOVED******REMOVED***,draw:function()***REMOVED***return this.drawScene(),this***REMOVED***,clear:function(a)***REMOVED***return this.getContext().clear(a),this***REMOVED***,setVisible:function(a)***REMOVED***return Kinetic.Node.prototype.setVisible.call(this,a),this.getCanvas()._canvas.style.display=a?"block":"none",this***REMOVED******REMOVED***),Kinetic.Util.extend(Kinetic.FastLayer,Kinetic.BaseLayer),Kinetic.Collection.mapMethods(Kinetic.FastLayer)***REMOVED***(),function()***REMOVED***Kinetic.Util.addMethods(Kinetic.Group,***REMOVED***___init:function(a)***REMOVED***this.nodeType="Group",Kinetic.Container.call(this,a)***REMOVED***,_validateAdd:function(a)***REMOVED***var b=a.getType();"Group"!==b&&"Shape"!==b&&Kinetic.Util.error("You may only add groups and shapes to groups.")***REMOVED******REMOVED***),Kinetic.Util.extend(Kinetic.Group,Kinetic.Container),Kinetic.Collection.mapMethods(Kinetic.Group)***REMOVED***(),function()***REMOVED***Kinetic.Rect=function(a)***REMOVED***this.___init(a)***REMOVED***,Kinetic.Rect.prototype=***REMOVED***___init:function(a)***REMOVED***Kinetic.Shape.call(this,a),this.className="Rect",this.sceneFunc(this._sceneFunc)***REMOVED***,_sceneFunc:function(a)***REMOVED***var b=this.getCornerRadius(),c=this.getWidth(),d=this.getHeight();a.beginPath(),b?(a.moveTo(b,0),a.lineTo(c-b,0),a.arc(c-b,b,b,3*Math.PI/2,0,!1),a.lineTo(c,d-b),a.arc(c-b,d-b,b,0,Math.PI/2,!1),a.lineTo(b,d),a.arc(b,d-b,b,Math.PI/2,Math.PI,!1),a.lineTo(0,b),a.arc(b,b,b,Math.PI,3*Math.PI/2,!1)):a.rect(0,0,c,d),a.closePath(),a.fillStrokeShape(this)***REMOVED******REMOVED***,Kinetic.Util.extend(Kinetic.Rect,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Rect,"cornerRadius",0),Kinetic.Collection.mapMethods(Kinetic.Rect)***REMOVED***(),function()***REMOVED***var a=2*Math.PI-1e-4,b="Circle";Kinetic.Circle=function(a)***REMOVED***this.___init(a)***REMOVED***,Kinetic.Circle.prototype=***REMOVED***___init:function(a)***REMOVED***Kinetic.Shape.call(this,a),this.className=b,this.sceneFunc(this._sceneFunc)***REMOVED***,_sceneFunc:function(b)***REMOVED***b.beginPath(),b.arc(0,0,this.getRadius(),0,a,!1),b.closePath(),b.fillStrokeShape(this)***REMOVED***,getWidth:function()***REMOVED***return 2*this.getRadius()***REMOVED***,getHeight:function()***REMOVED***return 2*this.getRadius()***REMOVED***,setWidth:function(a)***REMOVED***Kinetic.Node.prototype.setWidth.call(this,a),this.setRadius(a/2)***REMOVED***,setHeight:function(a)***REMOVED***Kinetic.Node.prototype.setHeight.call(this,a),this.setRadius(a/2)***REMOVED******REMOVED***,Kinetic.Util.extend(Kinetic.Circle,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Circle,"radius",0),Kinetic.Collection.mapMethods(Kinetic.Circle)***REMOVED***(),function()***REMOVED***var a=2*Math.PI-1e-4,b="Ellipse";Kinetic.Ellipse=function(a)***REMOVED***this.___init(a)***REMOVED***,Kinetic.Ellipse.prototype=***REMOVED***___init:function(a)***REMOVED***Kinetic.Shape.call(this,a),this.className=b,this.sceneFunc(this._sceneFunc)***REMOVED***,_sceneFunc:function(b)***REMOVED***var c=this.getRadius(),d=c.x,e=c.y;b.beginPath(),b.save(),d!==e&&b.scale(1,e/d),b.arc(0,0,d,0,a,!1),b.restore(),b.closePath(),b.fillStrokeShape(this)***REMOVED***,getWidth:function()***REMOVED***return 2*this.getRadius().x***REMOVED***,getHeight:function()***REMOVED***return 2*this.getRadius().y***REMOVED***,setWidth:function(a)***REMOVED***Kinetic.Node.prototype.setWidth.call(this,a),this.setRadius(***REMOVED***x:a/2***REMOVED***)***REMOVED***,setHeight:function(a)***REMOVED***Kinetic.Node.prototype.setHeight.call(this,a),this.setRadius(***REMOVED***y:a/2***REMOVED***)***REMOVED******REMOVED***,Kinetic.Util.extend(Kinetic.Ellipse,Kinetic.Shape),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Ellipse,"radius",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Ellipse,"radiusX",0),Kinetic.Factory.addGetterSetter(Kinetic.Ellipse,"radiusY",0),Kinetic.Collection.mapMethods(Kinetic.Ellipse)***REMOVED***(),function()***REMOVED***var a=2*Math.PI-1e-4;Kinetic.Ring=function(a)***REMOVED***this.___init(a)***REMOVED***,Kinetic.Ring.prototype=***REMOVED***___init:function(a)***REMOVED***Kinetic.Shape.call(this,a),this.className="Ring",this.sceneFunc(this._sceneFunc)***REMOVED***,_sceneFunc:function(b)***REMOVED***b.beginPath(),b.arc(0,0,this.getInnerRadius(),0,a,!1),b.moveTo(this.getOuterRadius(),0),b.arc(0,0,this.getOuterRadius(),a,0,!0),b.closePath(),b.fillStrokeShape(this)***REMOVED***,getWidth:function()***REMOVED***return 2*this.getOuterRadius()***REMOVED***,getHeight:function()***REMOVED***return 2*this.getOuterRadius()***REMOVED***,setWidth:function(a)***REMOVED***Kinetic.Node.prototype.setWidth.call(this,a),this.setOuterRadius(a/2)***REMOVED***,setHeight:function(a)***REMOVED***Kinetic.Node.prototype.setHeight.call(this,a),this.setOuterRadius(a/2)***REMOVED******REMOVED***,Kinetic.Util.extend(Kinetic.Ring,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Ring,"innerRadius",0),Kinetic.Factory.addGetterSetter(Kinetic.Ring,"outerRadius",0),Kinetic.Collection.mapMethods(Kinetic.Ring)***REMOVED***(),function()***REMOVED***Kinetic.Wedge=function(a)***REMOVED***this.___init(a)***REMOVED***,Kinetic.Wedge.prototype=***REMOVED***___init:function(a)***REMOVED***Kinetic.Shape.call(this,a),this.className="Wedge",this.sceneFunc(this._sceneFunc)***REMOVED***,_sceneFunc:function(a)***REMOVED***a.beginPath(),a.arc(0,0,this.getRadius(),0,Kinetic.getAngle(this.getAngle()),this.getClockwise()),a.lineTo(0,0),a.closePath(),a.fillStrokeShape(this)***REMOVED******REMOVED***,Kinetic.Util.extend(Kinetic.Wedge,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Wedge,"radius",0),Kinetic.Factory.addGetterSetter(Kinetic.Wedge,"angle",0),Kinetic.Factory.addGetterSetter(Kinetic.Wedge,"clockwise",!1),Kinetic.Factory.backCompat(Kinetic.Wedge,***REMOVED***angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"***REMOVED***),Kinetic.Collection.mapMethods(Kinetic.Wedge)***REMOVED***(),function()***REMOVED***Math.PI/180;Kinetic.Arc=function(a)***REMOVED***this.___init(a)***REMOVED***,Kinetic.Arc.prototype=***REMOVED***___init:function(a)***REMOVED***Kinetic.Shape.call(this,a),this.className="Arc",this.sceneFunc(this._sceneFunc)***REMOVED***,_sceneFunc:function(a)***REMOVED***var b=Kinetic.getAngle(this.angle()),c=this.clockwise();a.beginPath(),a.arc(0,0,this.getOuterRadius(),0,b,c),a.arc(0,0,this.getInnerRadius(),b,0,!c),a.closePath(),a.fillStrokeShape(this)***REMOVED******REMOVED***,Kinetic.Util.extend(Kinetic.Arc,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Arc,"innerRadius",0),Kinetic.Factory.addGetterSetter(Kinetic.Arc,"outerRadius",0),Kinetic.Factory.addGetterSetter(Kinetic.Arc,"angle",0),Kinetic.Factory.addGetterSetter(Kinetic.Arc,"clockwise",!1),Kinetic.Collection.mapMethods(Kinetic.Arc)***REMOVED***(),function()***REMOVED***var a="Image";Kinetic.Image=function(a)***REMOVED***this.___init(a)***REMOVED***,Kinetic.Image.prototype=***REMOVED***___init:function(b)***REMOVED***Kinetic.Shape.call(this,b),this.className=a,this.sceneFunc(this._sceneFunc),this.hitFunc(this._hitFunc)***REMOVED***,_useBufferCanvas:function()***REMOVED***return(this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasStroke()***REMOVED***,_sceneFunc:function(a)***REMOVED***var b,c,d,e,f=this.getWidth(),g=this.getHeight(),h=this.getImage();h&&(b=this.getCrop(),c=b.width,d=b.height,e=c&&d?[h,b.x,b.y,c,d,0,0,f,g]:[h,0,0,f,g]),a.beginPath(),a.rect(0,0,f,g),a.closePath(),a.fillStrokeShape(this),h&&a.drawImage.apply(a,e)***REMOVED***,_hitFunc:function(a)***REMOVED***var b=this.getWidth(),c=this.getHeight();a.beginPath(),a.rect(0,0,b,c),a.closePath(),a.fillStrokeShape(this)***REMOVED***,getWidth:function()***REMOVED***var a=this.getImage();return this.attrs.width||(a?a.width:0)***REMOVED***,getHeight:function()***REMOVED***var a=this.getImage();return this.attrs.height||(a?a.height:0)***REMOVED******REMOVED***,Kinetic.Util.extend(Kinetic.Image,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Image,"image"),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Image,"crop",["x","y","width","height"]),Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropX",0),Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropY",0),Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropWidth",0),Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropHeight",0),Kinetic.Collection.mapMethods(Kinetic.Image)***REMOVED***(),function()***REMOVED***function a(a)***REMOVED***a.fillText(this.partialText,0,0)***REMOVED***function b(a)***REMOVED***a.strokeText(this.partialText,0,0)***REMOVED***var c="auto",d="center",e="Change.kinetic",f="2d",g="-",h="",i="left",j="text",k="Text",l="middle",m="normal",n="px ",o=" ",p="right",q="word",r="char",s="none",t=["fontFamily","fontSize","fontStyle","fontVariant","padding","align","lineHeight","text","width","height","wrap"],u=t.length,v=Kinetic.Util.createCanvasElement().getContext(f);Kinetic.Text=function(a)***REMOVED***this.___init(a)***REMOVED***,Kinetic.Text.prototype=***REMOVED***___init:function(d)***REMOVED***var f=this;void 0===d.width&&(d.width=c),void 0===d.height&&(d.height=c),Kinetic.Shape.call(this,d),this._fillFunc=a,this._strokeFunc=b,this.className=k;for(var g=0;u>g;g++)this.on(t[g]+e,f._setTextData);this._setTextData(),this.sceneFunc(this._sceneFunc),this.hitFunc(this._hitFunc)***REMOVED***,_sceneFunc:function(a)***REMOVED***var b,c=this.getPadding(),e=this.getTextHeight(),f=this.getLineHeight()*e,g=this.textArr,h=g.length,j=this.getWidth();for(a.setAttr("font",this._getContextFont()),a.setAttr("textBaseline",l),a.setAttr("textAlign",i),a.save(),a.translate(c,0),a.translate(0,c+e/2),b=0;h>b;b++)***REMOVED***var k=g[b],m=k.text,n=k.width;a.save(),this.getAlign()===p?a.translate(j-n-2*c,0):this.getAlign()===d&&a.translate((j-n-2*c)/2,0),this.partialText=m,a.fillStrokeShape(this),a.restore(),a.translate(0,f)***REMOVED***a.restore()***REMOVED***,_hitFunc:function(a)***REMOVED***var b=this.getWidth(),c=this.getHeight();a.beginPath(),a.rect(0,0,b,c),a.closePath(),a.fillStrokeShape(this)***REMOVED***,setText:function(a)***REMOVED***var b=Kinetic.Util._isString(a)?a:a.toString();return this._setAttr(j,b),this***REMOVED***,getWidth:function()***REMOVED***return this.attrs.width===c?this.getTextWidth()+2*this.getPadding():this.attrs.width***REMOVED***,getHeight:function()***REMOVED***return this.attrs.height===c?this.getTextHeight()*this.textArr.length*this.getLineHeight()+2*this.getPadding():this.attrs.height***REMOVED***,getTextWidth:function()***REMOVED***return this.textWidth***REMOVED***,getTextHeight:function()***REMOVED***return this.textHeight***REMOVED***,_getTextSize:function(a)***REMOVED***var b,c=v,d=this.getFontSize();return c.save(),c.font=this._getContextFont(),b=c.measureText(a),c.restore(),***REMOVED***width:b.width,height:parseInt(d,10)***REMOVED******REMOVED***,_getContextFont:function()***REMOVED***return this.getFontStyle()+o+this.getFontVariant()+o+this.getFontSize()+n+this.getFontFamily()***REMOVED***,_addTextLine:function(a,b)***REMOVED***return this.textArr.push(***REMOVED***text:a,width:b***REMOVED***)***REMOVED***,_getTextWidth:function(a)***REMOVED***return v.measureText(a).width***REMOVED***,_setTextData:function()***REMOVED***var a=this.getText().split("\n"),b=+this.getFontSize(),d=0,e=this.getLineHeight()*b,f=this.attrs.width,h=this.attrs.height,i=f!==c,j=h!==c,k=this.getPadding(),l=f-2*k,m=h-2*k,n=0,p=this.getWrap(),q=p!==s,t=p!==r&&q;this.textArr=[],v.save(),v.font=this._getContextFont();for(var u=0,w=a.length;w>u;++u)***REMOVED***var x=a[u],y=this._getTextWidth(x);if(i&&y>l)for(;x.length>0;)***REMOVED***for(var z=0,A=x.length,B="",C=0;A>z;)***REMOVED***var D=z+A>>>1,E=x.slice(0,D+1),F=this._getTextWidth(E);l>=F?(z=D+1,B=E,C=F):A=D***REMOVED***if(!B)break;if(t)***REMOVED***var G=Math.max(B.lastIndexOf(o),B.lastIndexOf(g))+1;G>0&&(z=G,B=B.slice(0,z),C=this._getTextWidth(B))
***REMOVED***if(this._addTextLine(B,C),d=Math.max(d,C),n+=e,!q||j&&n+e>m)break;if(x=x.slice(z),x.length>0&&(y=this._getTextWidth(x),l>=y))***REMOVED***this._addTextLine(x,y),n+=e,d=Math.max(d,y);break***REMOVED******REMOVED***else this._addTextLine(x,y),n+=e,d=Math.max(d,y);if(j&&n+e>m)break***REMOVED***v.restore(),this.textHeight=b,this.textWidth=d***REMOVED******REMOVED***,Kinetic.Util.extend(Kinetic.Text,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontFamily","Arial"),Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontSize",12),Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontStyle",m),Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontVariant",m),Kinetic.Factory.addGetterSetter(Kinetic.Text,"padding",0),Kinetic.Factory.addGetterSetter(Kinetic.Text,"align",i),Kinetic.Factory.addGetterSetter(Kinetic.Text,"lineHeight",1),Kinetic.Factory.addGetterSetter(Kinetic.Text,"wrap",q),Kinetic.Factory.addGetter(Kinetic.Text,"text",h),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Text,"text"),Kinetic.Collection.mapMethods(Kinetic.Text)***REMOVED***(),function()***REMOVED***Kinetic.Line=function(a)***REMOVED***this.___init(a)***REMOVED***,Kinetic.Line.prototype=***REMOVED***___init:function(a)***REMOVED***Kinetic.Shape.call(this,a),this.className="Line",this.on("pointsChange.kinetic tensionChange.kinetic closedChange.kinetic",function()***REMOVED***this._clearCache("tensionPoints")***REMOVED***),this.sceneFunc(this._sceneFunc)***REMOVED***,_sceneFunc:function(a)***REMOVED***var b,c,d,e=this.getPoints(),f=e.length,g=this.getTension(),h=this.getClosed();if(a.beginPath(),a.moveTo(e[0],e[1]),0!==g&&f>4)***REMOVED***for(b=this.getTensionPoints(),c=b.length,d=h?0:4,h||a.quadraticCurveTo(b[0],b[1],b[2],b[3]);c-2>d;)a.bezierCurveTo(b[d++],b[d++],b[d++],b[d++],b[d++],b[d++]);h||a.quadraticCurveTo(b[c-2],b[c-1],e[f-2],e[f-1])***REMOVED***else for(d=2;f>d;d+=2)a.lineTo(e[d],e[d+1]);h?(a.closePath(),a.fillStrokeShape(this)):a.strokeShape(this)***REMOVED***,getTensionPoints:function()***REMOVED***return this._getCache("tensionPoints",this._getTensionPoints)***REMOVED***,_getTensionPoints:function()***REMOVED***return this.getClosed()?this._getTensionPointsClosed():Kinetic.Util._expandPoints(this.getPoints(),this.getTension())***REMOVED***,_getTensionPointsClosed:function()***REMOVED***var a=this.getPoints(),b=a.length,c=this.getTension(),d=Kinetic.Util,e=d._getControlPoints(a[b-2],a[b-1],a[0],a[1],a[2],a[3],c),f=d._getControlPoints(a[b-4],a[b-3],a[b-2],a[b-1],a[0],a[1],c),g=Kinetic.Util._expandPoints(a,c),h=[e[2],e[3]].concat(g).concat([f[0],f[1],a[b-2],a[b-1],f[2],f[3],e[0],e[1],a[0],a[1]]);return h***REMOVED******REMOVED***,Kinetic.Util.extend(Kinetic.Line,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Line,"closed",!1),Kinetic.Factory.addGetterSetter(Kinetic.Line,"tension",0),Kinetic.Factory.addGetterSetter(Kinetic.Line,"points"),Kinetic.Collection.mapMethods(Kinetic.Line)***REMOVED***(),function()***REMOVED***Kinetic.Sprite=function(a)***REMOVED***this.___init(a)***REMOVED***,Kinetic.Sprite.prototype=***REMOVED***___init:function(a)***REMOVED***Kinetic.Shape.call(this,a),this.className="Sprite",this.anim=new Kinetic.Animation,this.on("animationChange.kinetic",function()***REMOVED***this.frameIndex(0)***REMOVED***),this.on("frameRateChange.kinetic",function()***REMOVED***this.anim.isRunning()&&(clearInterval(this.interval),this._setInterval())***REMOVED***),this.sceneFunc(this._sceneFunc),this.hitFunc(this._hitFunc)***REMOVED***,_sceneFunc:function(a)***REMOVED***var b=this.getAnimation(),c=this.frameIndex(),d=4*c,e=this.getAnimations()[b],f=e[d+0],g=e[d+1],h=e[d+2],i=e[d+3],j=this.getImage();j&&a.drawImage(j,f,g,h,i,0,0,h,i)***REMOVED***,_hitFunc:function(a)***REMOVED***var b=this.getAnimation(),c=this.frameIndex(),d=4*c,e=this.getAnimations()[b],f=e[d+2],g=e[d+3];a.beginPath(),a.rect(0,0,f,g),a.closePath(),a.fillShape(this)***REMOVED***,_useBufferCanvas:function()***REMOVED***return(this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasStroke()***REMOVED***,_setInterval:function()***REMOVED***var a=this;this.interval=setInterval(function()***REMOVED***a._updateIndex()***REMOVED***,1e3/this.getFrameRate())***REMOVED***,start:function()***REMOVED***var a=this.getLayer();this.anim.setLayers(a),this._setInterval(),this.anim.start()***REMOVED***,stop:function()***REMOVED***this.anim.stop(),clearInterval(this.interval)***REMOVED***,isRunning:function()***REMOVED***return this.anim.isRunning()***REMOVED***,_updateIndex:function()***REMOVED***var a=this.frameIndex(),b=this.getAnimation(),c=this.getAnimations(),d=c[b],e=d.length/4;this.frameIndex(e-1>a?a+1:0)***REMOVED******REMOVED***,Kinetic.Util.extend(Kinetic.Sprite,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"animation"),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"animations"),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"image"),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"frameIndex",0),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"frameRate",17),Kinetic.Factory.backCompat(Kinetic.Sprite,***REMOVED***index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"***REMOVED***),Kinetic.Collection.mapMethods(Kinetic.Sprite)***REMOVED***(),function()***REMOVED***Kinetic.Path=function(a)***REMOVED***this.___init(a)***REMOVED***,Kinetic.Path.prototype=***REMOVED***___init:function(a)***REMOVED***this.dataArray=[];var b=this;Kinetic.Shape.call(this,a),this.className="Path",this.dataArray=Kinetic.Path.parsePathData(this.getData()),this.on("dataChange.kinetic",function()***REMOVED***b.dataArray=Kinetic.Path.parsePathData(this.getData())***REMOVED***),this.sceneFunc(this._sceneFunc)***REMOVED***,_sceneFunc:function(a)***REMOVED***var b=this.dataArray,c=!1;a.beginPath();for(var d=0;d<b.length;d++)***REMOVED***var e=b[d].command,f=b[d].points;switch(e)***REMOVED***case"L":a.lineTo(f[0],f[1]);break;case"M":a.moveTo(f[0],f[1]);break;case"C":a.bezierCurveTo(f[0],f[1],f[2],f[3],f[4],f[5]);break;case"Q":a.quadraticCurveTo(f[0],f[1],f[2],f[3]);break;case"A":var g=f[0],h=f[1],i=f[2],j=f[3],k=f[4],l=f[5],m=f[6],n=f[7],o=i>j?i:j,p=i>j?1:i/j,q=i>j?j/i:1;a.translate(g,h),a.rotate(m),a.scale(p,q),a.arc(0,0,o,k,k+l,1-n),a.scale(1/p,1/q),a.rotate(-m),a.translate(-g,-h);break;case"z":a.closePath(),c=!0***REMOVED******REMOVED***c?a.fillStrokeShape(this):a.strokeShape(this)***REMOVED******REMOVED***,Kinetic.Util.extend(Kinetic.Path,Kinetic.Shape),Kinetic.Path.getLineLength=function(a,b,c,d)***REMOVED***return Math.sqrt((c-a)*(c-a)+(d-b)*(d-b))***REMOVED***,Kinetic.Path.getPointOnLine=function(a,b,c,d,e,f,g)***REMOVED***void 0===f&&(f=b),void 0===g&&(g=c);var h=(e-c)/(d-b+1e-8),i=Math.sqrt(a*a/(1+h*h));b>d&&(i*=-1);var j,k=h*i;if(d===b)j=***REMOVED***x:f,y:g+k***REMOVED***;else if((g-c)/(f-b+1e-8)===h)j=***REMOVED***x:f+i,y:g+k***REMOVED***;else***REMOVED***var l,m,n=this.getLineLength(b,c,d,e);if(1e-8>n)return void 0;var o=(f-b)*(d-b)+(g-c)*(e-c);o/=n*n,l=b+o*(d-b),m=c+o*(e-c);var p=this.getLineLength(f,g,l,m),q=Math.sqrt(a*a-p*p);i=Math.sqrt(q*q/(1+h*h)),b>d&&(i*=-1),k=h*i,j=***REMOVED***x:l+i,y:m+k***REMOVED******REMOVED***return j***REMOVED***,Kinetic.Path.getPointOnCubicBezier=function(a,b,c,d,e,f,g,h,i)***REMOVED***function j(a)***REMOVED***return a*a*a***REMOVED***function k(a)***REMOVED***return 3*a*a*(1-a)***REMOVED***function l(a)***REMOVED***return 3*a*(1-a)*(1-a)***REMOVED***function m(a)***REMOVED***return(1-a)*(1-a)*(1-a)***REMOVED***var n=h*j(a)+f*k(a)+d*l(a)+b*m(a),o=i*j(a)+g*k(a)+e*l(a)+c*m(a);return***REMOVED***x:n,y:o***REMOVED******REMOVED***,Kinetic.Path.getPointOnQuadraticBezier=function(a,b,c,d,e,f,g)***REMOVED***function h(a)***REMOVED***return a*a***REMOVED***function i(a)***REMOVED***return 2*a*(1-a)***REMOVED***function j(a)***REMOVED***return(1-a)*(1-a)***REMOVED***var k=f*h(a)+d*i(a)+b*j(a),l=g*h(a)+e*i(a)+c*j(a);return***REMOVED***x:k,y:l***REMOVED******REMOVED***,Kinetic.Path.getPointOnEllipticalArc=function(a,b,c,d,e,f)***REMOVED***var g=Math.cos(f),h=Math.sin(f),i=***REMOVED***x:c*Math.cos(e),y:d*Math.sin(e)***REMOVED***;return***REMOVED***x:a+(i.x*g-i.y*h),y:b+(i.x*h+i.y*g)***REMOVED******REMOVED***,Kinetic.Path.parsePathData=function(a)***REMOVED***if(!a)return[];var b=a,c=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];b=b.replace(new RegExp(" ","g"),",");for(var d=0;d<c.length;d++)b=b.replace(new RegExp(c[d],"g"),"|"+c[d]);var e=b.split("|"),f=[],g=0,h=0;for(d=1;d<e.length;d++)***REMOVED***var i=e[d],j=i.charAt(0);i=i.slice(1),i=i.replace(new RegExp(",-","g"),"-"),i=i.replace(new RegExp("-","g"),",-"),i=i.replace(new RegExp("e,-","g"),"e-");var k=i.split(",");k.length>0&&""===k[0]&&k.shift();for(var l=0;l<k.length;l++)k[l]=parseFloat(k[l]);for(;k.length>0&&!isNaN(k[0]);)***REMOVED***var m,n,o,p,q,r,s,t,u,v,w=null,x=[],y=g,z=h;switch(j)***REMOVED***case"l":g+=k.shift(),h+=k.shift(),w="L",x.push(g,h);break;case"L":g=k.shift(),h=k.shift(),x.push(g,h);break;case"m":var A=k.shift(),B=k.shift();if(g+=A,h+=B,w="M",f.length>2&&"z"===f[f.length-1].command)for(var C=f.length-2;C>=0;C--)if("M"===f[C].command)***REMOVED***g=f[C].points[0]+A,h=f[C].points[1]+B;break***REMOVED***x.push(g,h),j="l";break;case"M":g=k.shift(),h=k.shift(),w="M",x.push(g,h),j="L";break;case"h":g+=k.shift(),w="L",x.push(g,h);break;case"H":g=k.shift(),w="L",x.push(g,h);break;case"v":h+=k.shift(),w="L",x.push(g,h);break;case"V":h=k.shift(),w="L",x.push(g,h);break;case"C":x.push(k.shift(),k.shift(),k.shift(),k.shift()),g=k.shift(),h=k.shift(),x.push(g,h);break;case"c":x.push(g+k.shift(),h+k.shift(),g+k.shift(),h+k.shift()),g+=k.shift(),h+=k.shift(),w="C",x.push(g,h);break;case"S":n=g,o=h,m=f[f.length-1],"C"===m.command&&(n=g+(g-m.points[2]),o=h+(h-m.points[3])),x.push(n,o,k.shift(),k.shift()),g=k.shift(),h=k.shift(),w="C",x.push(g,h);break;case"s":n=g,o=h,m=f[f.length-1],"C"===m.command&&(n=g+(g-m.points[2]),o=h+(h-m.points[3])),x.push(n,o,g+k.shift(),h+k.shift()),g+=k.shift(),h+=k.shift(),w="C",x.push(g,h);break;case"Q":x.push(k.shift(),k.shift()),g=k.shift(),h=k.shift(),x.push(g,h);break;case"q":x.push(g+k.shift(),h+k.shift()),g+=k.shift(),h+=k.shift(),w="Q",x.push(g,h);break;case"T":n=g,o=h,m=f[f.length-1],"Q"===m.command&&(n=g+(g-m.points[0]),o=h+(h-m.points[1])),g=k.shift(),h=k.shift(),w="Q",x.push(n,o,g,h);break;case"t":n=g,o=h,m=f[f.length-1],"Q"===m.command&&(n=g+(g-m.points[0]),o=h+(h-m.points[1])),g+=k.shift(),h+=k.shift(),w="Q",x.push(n,o,g,h);break;case"A":p=k.shift(),q=k.shift(),r=k.shift(),s=k.shift(),t=k.shift(),u=g,v=h,g=k.shift(),h=k.shift(),w="A",x=this.convertEndpointToCenterParameterization(u,v,g,h,s,t,p,q,r);break;case"a":p=k.shift(),q=k.shift(),r=k.shift(),s=k.shift(),t=k.shift(),u=g,v=h,g+=k.shift(),h+=k.shift(),w="A",x=this.convertEndpointToCenterParameterization(u,v,g,h,s,t,p,q,r)***REMOVED***f.push(***REMOVED***command:w||j,points:x,start:***REMOVED***x:y,y:z***REMOVED***,pathLength:this.calcLength(y,z,w||j,x)***REMOVED***)***REMOVED***("z"===j||"Z"===j)&&f.push(***REMOVED***command:"z",points:[],start:void 0,pathLength:0***REMOVED***)***REMOVED***return f***REMOVED***,Kinetic.Path.calcLength=function(a,b,c,d)***REMOVED***var e,f,g,h,i=Kinetic.Path;switch(c)***REMOVED***case"L":return i.getLineLength(a,b,d[0],d[1]);case"C":for(e=0,f=i.getPointOnCubicBezier(0,a,b,d[0],d[1],d[2],d[3],d[4],d[5]),h=.01;1>=h;h+=.01)g=i.getPointOnCubicBezier(h,a,b,d[0],d[1],d[2],d[3],d[4],d[5]),e+=i.getLineLength(f.x,f.y,g.x,g.y),f=g;return e;case"Q":for(e=0,f=i.getPointOnQuadraticBezier(0,a,b,d[0],d[1],d[2],d[3]),h=.01;1>=h;h+=.01)g=i.getPointOnQuadraticBezier(h,a,b,d[0],d[1],d[2],d[3]),e+=i.getLineLength(f.x,f.y,g.x,g.y),f=g;return e;case"A":e=0;var j=d[4],k=d[5],l=d[4]+k,m=Math.PI/180;if(Math.abs(j-l)<m&&(m=Math.abs(j-l)),f=i.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],j,0),0>k)for(h=j-m;h>l;h-=m)g=i.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],h,0),e+=i.getLineLength(f.x,f.y,g.x,g.y),f=g;else for(h=j+m;l>h;h+=m)g=i.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],h,0),e+=i.getLineLength(f.x,f.y,g.x,g.y),f=g;return g=i.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],l,0),e+=i.getLineLength(f.x,f.y,g.x,g.y)***REMOVED***return 0***REMOVED***,Kinetic.Path.convertEndpointToCenterParameterization=function(a,b,c,d,e,f,g,h,i)***REMOVED***var j=i*(Math.PI/180),k=Math.cos(j)*(a-c)/2+Math.sin(j)*(b-d)/2,l=-1*Math.sin(j)*(a-c)/2+Math.cos(j)*(b-d)/2,m=k*k/(g*g)+l*l/(h*h);m>1&&(g*=Math.sqrt(m),h*=Math.sqrt(m));var n=Math.sqrt((g*g*h*h-g*g*l*l-h*h*k*k)/(g*g*l*l+h*h*k*k));e===f&&(n*=-1),isNaN(n)&&(n=0);var o=n*g*l/h,p=n*-h*k/g,q=(a+c)/2+Math.cos(j)*o-Math.sin(j)*p,r=(b+d)/2+Math.sin(j)*o+Math.cos(j)*p,s=function(a)***REMOVED***return Math.sqrt(a[0]*a[0]+a[1]*a[1])***REMOVED***,t=function(a,b)***REMOVED***return(a[0]*b[0]+a[1]*b[1])/(s(a)*s(b))***REMOVED***,u=function(a,b)***REMOVED***return(a[0]*b[1]<a[1]*b[0]?-1:1)*Math.acos(t(a,b))***REMOVED***,v=u([1,0],[(k-o)/g,(l-p)/h]),w=[(k-o)/g,(l-p)/h],x=[(-1*k-o)/g,(-1*l-p)/h],y=u(w,x);return t(w,x)<=-1&&(y=Math.PI),t(w,x)>=1&&(y=0),0===f&&y>0&&(y-=2*Math.PI),1===f&&0>y&&(y+=2*Math.PI),[q,r,g,h,v,y,j,f]***REMOVED***,Kinetic.Factory.addGetterSetter(Kinetic.Path,"data"),Kinetic.Collection.mapMethods(Kinetic.Path)***REMOVED***(),function()***REMOVED***function a(a)***REMOVED***a.fillText(this.partialText,0,0)***REMOVED***function b(a)***REMOVED***a.strokeText(this.partialText,0,0)***REMOVED***var c="",d="normal";Kinetic.TextPath=function(a)***REMOVED***this.___init(a)***REMOVED***,Kinetic.TextPath.prototype=***REMOVED***___init:function(c)***REMOVED***var d=this;this.dummyCanvas=Kinetic.Util.createCanvasElement(),this.dataArray=[],Kinetic.Shape.call(this,c),this._fillFunc=a,this._strokeFunc=b,this._fillFuncHit=a,this._strokeFuncHit=b,this.className="TextPath",this.dataArray=Kinetic.Path.parsePathData(this.attrs.data),this.on("dataChange.kinetic",function()***REMOVED***d.dataArray=Kinetic.Path.parsePathData(this.attrs.data)***REMOVED***),this.on("textChange.kinetic textStroke.kinetic textStrokeWidth.kinetic",d._setTextData),d._setTextData(),this.sceneFunc(this._sceneFunc)***REMOVED***,_sceneFunc:function(a)***REMOVED***a.setAttr("font",this._getContextFont()),a.setAttr("textBaseline","middle"),a.setAttr("textAlign","left"),a.save();for(var b=this.glyphInfo,c=0;c<b.length;c++)***REMOVED***a.save();var d=b[c].p0;a.translate(d.x,d.y),a.rotate(b[c].rotation),this.partialText=b[c].text,a.fillStrokeShape(this),a.restore()***REMOVED***a.restore()***REMOVED***,getTextWidth:function()***REMOVED***return this.textWidth***REMOVED***,getTextHeight:function()***REMOVED***return this.textHeight***REMOVED***,setText:function(a)***REMOVED***Kinetic.Text.prototype.setText.call(this,a)***REMOVED***,_getTextSize:function(a)***REMOVED***var b=this.dummyCanvas,c=b.getContext("2d");c.save(),c.font=this._getContextFont();var d=c.measureText(a);return c.restore(),***REMOVED***width:d.width,height:parseInt(this.attrs.fontSize,10)***REMOVED******REMOVED***,_setTextData:function()***REMOVED***var a=this,b=this._getTextSize(this.attrs.text);this.textWidth=b.width,this.textHeight=b.height,this.glyphInfo=[];for(var c,d,e,f=this.attrs.text.split(""),g=-1,h=0,i=function()***REMOVED***h=0;for(var b=a.dataArray,d=g+1;d<b.length;d++)***REMOVED***if(b[d].pathLength>0)return g=d,b[d];"M"==b[d].command&&(c=***REMOVED***x:b[d].points[0],y:b[d].points[1]***REMOVED***)***REMOVED***return***REMOVED******REMOVED******REMOVED***,j=function(b)***REMOVED***var f=a._getTextSize(b).width,g=0,j=0;for(d=void 0;Math.abs(f-g)/f>.01&&25>j;)***REMOVED***j++;for(var k=g;void 0===e;)e=i(),e&&k+e.pathLength<f&&(k+=e.pathLength,e=void 0);if(e===***REMOVED******REMOVED***||void 0===c)return void 0;var l=!1;switch(e.command)***REMOVED***case"L":Kinetic.Path.getLineLength(c.x,c.y,e.points[0],e.points[1])>f?d=Kinetic.Path.getPointOnLine(f,c.x,c.y,e.points[0],e.points[1],c.x,c.y):e=void 0;break;case"A":var m=e.points[4],n=e.points[5],o=e.points[4]+n;0===h?h=m+1e-8:f>g?h+=Math.PI/180*n/Math.abs(n):h-=Math.PI/360*n/Math.abs(n),(0>n&&o>h||n>=0&&h>o)&&(h=o,l=!0),d=Kinetic.Path.getPointOnEllipticalArc(e.points[0],e.points[1],e.points[2],e.points[3],h,e.points[6]);break;case"C":0===h?h=f>e.pathLength?1e-8:f/e.pathLength:f>g?h+=(f-g)/e.pathLength:h-=(g-f)/e.pathLength,h>1&&(h=1,l=!0),d=Kinetic.Path.getPointOnCubicBezier(h,e.start.x,e.start.y,e.points[0],e.points[1],e.points[2],e.points[3],e.points[4],e.points[5]);break;case"Q":0===h?h=f/e.pathLength:f>g?h+=(f-g)/e.pathLength:h-=(g-f)/e.pathLength,h>1&&(h=1,l=!0),d=Kinetic.Path.getPointOnQuadraticBezier(h,e.start.x,e.start.y,e.points[0],e.points[1],e.points[2],e.points[3])***REMOVED***void 0!==d&&(g=Kinetic.Path.getLineLength(c.x,c.y,d.x,d.y)),l&&(l=!1,e=void 0)***REMOVED******REMOVED***,k=0;k<f.length&&(j(f[k]),void 0!==c&&void 0!==d);k++)***REMOVED***var l=Kinetic.Path.getLineLength(c.x,c.y,d.x,d.y),m=0,n=Kinetic.Path.getPointOnLine(m+l/2,c.x,c.y,d.x,d.y),o=Math.atan2(d.y-c.y,d.x-c.x);this.glyphInfo.push(***REMOVED***transposeX:n.x,transposeY:n.y,text:f[k],rotation:o,p0:c,p1:d***REMOVED***),c=d***REMOVED******REMOVED******REMOVED***,Kinetic.TextPath.prototype._getContextFont=Kinetic.Text.prototype._getContextFont,Kinetic.Util.extend(Kinetic.TextPath,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontFamily","Arial"),Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontSize",12),Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontStyle",d),Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontVariant",d),Kinetic.Factory.addGetter(Kinetic.TextPath,"text",c),Kinetic.Collection.mapMethods(Kinetic.TextPath)***REMOVED***(),function()***REMOVED***Kinetic.RegularPolygon=function(a)***REMOVED***this.___init(a)***REMOVED***,Kinetic.RegularPolygon.prototype=***REMOVED***___init:function(a)***REMOVED***Kinetic.Shape.call(this,a),this.className="RegularPolygon",this.sceneFunc(this._sceneFunc)***REMOVED***,_sceneFunc:function(a)***REMOVED***var b,c,d,e=this.attrs.sides,f=this.attrs.radius;for(a.beginPath(),a.moveTo(0,0-f),b=1;e>b;b++)c=f*Math.sin(2*b*Math.PI/e),d=-1*f*Math.cos(2*b*Math.PI/e),a.lineTo(c,d);a.closePath(),a.fillStrokeShape(this)***REMOVED******REMOVED***,Kinetic.Util.extend(Kinetic.RegularPolygon,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.RegularPolygon,"radius",0),Kinetic.Factory.addGetterSetter(Kinetic.RegularPolygon,"sides",0),Kinetic.Collection.mapMethods(Kinetic.RegularPolygon)***REMOVED***(),function()***REMOVED***Kinetic.Star=function(a)***REMOVED***this.___init(a)***REMOVED***,Kinetic.Star.prototype=***REMOVED***___init:function(a)***REMOVED***Kinetic.Shape.call(this,a),this.className="Star",this.sceneFunc(this._sceneFunc)***REMOVED***,_sceneFunc:function(a)***REMOVED***var b=this.innerRadius(),c=this.outerRadius(),d=this.numPoints();a.beginPath(),a.moveTo(0,0-c);for(var e=1;2*d>e;e++)***REMOVED***var f=e%2===0?c:b,g=f*Math.sin(e*Math.PI/d),h=-1*f*Math.cos(e*Math.PI/d);a.lineTo(g,h)***REMOVED***a.closePath(),a.fillStrokeShape(this)***REMOVED******REMOVED***,Kinetic.Util.extend(Kinetic.Star,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Star,"numPoints",5),Kinetic.Factory.addGetterSetter(Kinetic.Star,"innerRadius",0),Kinetic.Factory.addGetterSetter(Kinetic.Star,"outerRadius",0),Kinetic.Collection.mapMethods(Kinetic.Star)***REMOVED***(),function()***REMOVED***var a=["fontFamily","fontSize","fontStyle","padding","lineHeight","text"],b="Change.kinetic",c="none",d="up",e="right",f="down",g="left",h="Label",i=a.length;Kinetic.Label=function(a)***REMOVED***this.____init(a)***REMOVED***,Kinetic.Label.prototype=***REMOVED***____init:function(a)***REMOVED***var b=this;this.className=h,Kinetic.Group.call(this,a),this.on("add.kinetic",function(a)***REMOVED***b._addListeners(a.child),b._sync()***REMOVED***)***REMOVED***,getText:function()***REMOVED***return this.find("Text")[0]***REMOVED***,getTag:function()***REMOVED***return this.find("Tag")[0]***REMOVED***,_addListeners:function(c)***REMOVED***var d,e=this,f=function()***REMOVED***e._sync()***REMOVED***;for(d=0;i>d;d++)c.on(a[d]+b,f)***REMOVED***,getWidth:function()***REMOVED***return this.getText().getWidth()***REMOVED***,getHeight:function()***REMOVED***return this.getText().getHeight()***REMOVED***,_sync:function()***REMOVED***var a,b,c,h,i,j,k,l=this.getText(),m=this.getTag();if(l&&m)***REMOVED***switch(a=l.getWidth(),b=l.getHeight(),c=m.getPointerDirection(),h=m.getPointerWidth(),k=m.getPointerHeight(),i=0,j=0,c)***REMOVED***case d:i=a/2,j=-1*k;break;case e:i=a+h,j=b/2;break;case f:i=a/2,j=b+k;break;case g:i=-1*h,j=b/2***REMOVED***m.setAttrs(***REMOVED***x:-1*i,y:-1*j,width:a,height:b***REMOVED***),l.setAttrs(***REMOVED***x:-1*i,y:-1*j***REMOVED***)***REMOVED******REMOVED******REMOVED***,Kinetic.Util.extend(Kinetic.Label,Kinetic.Group),Kinetic.Collection.mapMethods(Kinetic.Label),Kinetic.Tag=function(a)***REMOVED***this.___init(a)***REMOVED***,Kinetic.Tag.prototype=***REMOVED***___init:function(a)***REMOVED***Kinetic.Shape.call(this,a),this.className="Tag",this.sceneFunc(this._sceneFunc)***REMOVED***,_sceneFunc:function(a)***REMOVED***var b=this.getWidth(),c=this.getHeight(),h=this.getPointerDirection(),i=this.getPointerWidth(),j=this.getPointerHeight();a.beginPath(),a.moveTo(0,0),h===d&&(a.lineTo((b-i)/2,0),a.lineTo(b/2,-1*j),a.lineTo((b+i)/2,0)),a.lineTo(b,0),h===e&&(a.lineTo(b,(c-j)/2),a.lineTo(b+i,c/2),a.lineTo(b,(c+j)/2)),a.lineTo(b,c),h===f&&(a.lineTo((b+i)/2,c),a.lineTo(b/2,c+j),a.lineTo((b-i)/2,c)),a.lineTo(0,c),h===g&&(a.lineTo(0,(c+j)/2),a.lineTo(-1*i,c/2),a.lineTo(0,(c-j)/2)),a.closePath(),a.fillStrokeShape(this)***REMOVED******REMOVED***,Kinetic.Util.extend(Kinetic.Tag,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Tag,"pointerDirection",c),Kinetic.Factory.addGetterSetter(Kinetic.Tag,"pointerWidth",0),Kinetic.Factory.addGetterSetter(Kinetic.Tag,"pointerHeight",0),Kinetic.Factory.addGetterSetter(Kinetic.Tag,"cornerRadius",0),Kinetic.Collection.mapMethods(Kinetic.Tag)***REMOVED***();